<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><docs>https://blogs.law.harvard.edu/tech/rss</docs><title>nginx on Bryan Apperson</title><link>https://bryanapperson.com/tags/nginx/</link><description>Recent content in nginx on Bryan Apperson</description><image><title>nginx on Bryan Apperson</title><link>https://bryanapperson.com/tags/nginx/</link><url>https://source.unsplash.com/collection/983219/2000x1322</url></image><ttl>1440</ttl><generator>Hugo 0.81.0</generator><language>en-US</language><copyright>Copyright &amp;copy; Bryan Apperson. Licensed under CC-BY-ND-4.0. Hosted on Github.</copyright><lastBuildDate>Fri, 19 Mar 2021 02:46:39 UT</lastBuildDate><atom:link href="https://bryanapperson.com/tags/nginx/index.xml" rel="self" type="application/rss+xml"/><item><title>Install HHVM, Nginx on Ubuntu 14.04 - Make WordPress Fly</title><link>https://bryanapperson.com/blog/install-hhvm-nginx-on-ubuntu-14-04-make-wordpress-fly/</link><pubDate>Tue, 18 Feb 2020 00:12:01 UT</pubDate><dc:creator>Bryan Apperson</dc:creator><guid>https://bryanapperson.com/blog/install-hhvm-nginx-on-ubuntu-14-04-make-wordpress-fly/</guid><description>Installing HHVM and Nginx on Ubuntu 14.04 is the next step in the &amp;ldquo;Make WordPress Fly&amp;rdquo; series. This tutorial assumes you have completed the prerequisites, read Part 1 and completed Part 2 of this guide. At this point you have a reasonably secure box with MariaDB installed and configured. In this (Part 3) of the &amp;ldquo;Make WordPress Fly&amp;rdquo; guide we will start out by preparing our system for Nginx. The first step is to reconnect to your VM via SSH.</description><content:encoded><![CDATA[Installing HHVM and Nginx on Ubuntu 14.04 is the next step in the &amp;ldquo;Make WordPress Fly&amp;rdquo; series. This tutorial assumes you have completed the prerequisites, read Part 1 and completed Part 2 of this guide. At this point you have a reasonably secure box with MariaDB installed and configured. In this (Part 3) of the &amp;ldquo;Make WordPress Fly&amp;rdquo; guide we will start out by preparing our system for Nginx. The first step is to reconnect to your VM via SSH.
ssh -p port user@you.rip.add.res
Installing Nginx on Ubuntu 14.04 After reconnecting we are going to install some prerequisites in this order to make sure HHVM plays nicely with Nginx and WordPress.
sudo apt-get update sudo apt-get install php5-gd libssh2-php After that process completes it is time to install Nginx. Installing Nginx on Ubuntu 14.04 is a very easy process. Ubuntu official repos come with a Nginx package but I prefer using launchpad repo maintained by Nginx team. We will also install the Naxsi WAF (Web Application Firewall) to provide some added security. You can choose not load Naxsi later as it slows down cached requests per second by around 3%. However, a full fledged WAF is worth a 3% requests per second hit.
sudo add-apt-repository ppa:nginx/stable sudo apt-get update sudo apt-get install nginx-naxsi If you prefer to use Nginx package in Ubuntu repo, you can simply run following command:
sudo apt-get install nginx-naxsi
That concludes the process of installing Nginx. We will configure it further in later parts of this tutorial series based on whether you use WordPress Multisite or a single install.
Installing HHVM on Ubuntu 14.04 Let&amp;rsquo;s move on to installing HHVM on Ubuntu 14.04. We&amp;rsquo;ll need to prepare the HHVM repositories. Using sudo or as root user it is recommended to run sudo apt-get update and sudo apt-get upgrade first, or you may receive errors. Then we are ready to add the repositories and install HHVM.
wget -O - http://dl.hhvm.com/conf/hhvm.gpg.key | sudo apt-key add - echo deb http://dl.hhvm.com/ubuntu trusty main | sudo tee /etc/apt/sources.list.d/hhvm.list sudo apt-get update sudo apt-get install hhvm Now that HHVM is installed there are a few simple configurations to apply. HHVM comes bundled with a script that makes setting it up with Ubuntu very easy. If you are already using Nginx with PHP-FPM, you&amp;rsquo;ll have to modify the configuration file to disable the use of PHP-FPM. This file is normally located at /etc/nginx/sites-available/default Look for the following section and make sure it&amp;rsquo;s all commented (by adding a # at the beginning of each line)
# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \.php$ { # fastcgi_split_path_info ^(.&#43;\.php)(/.&#43;)$; # # NOTE: You should have &amp;quot;cgi.fix_pathinfo = 0;&amp;quot; in php.ini # # # With php5-cgi alone: # fastcgi_pass 127.0.0.1:9000; # # With php5-fpm: # fastcgi_pass unix:/var/run/php5-fpm.sock; # fastcgi_index index.php; # include fastcgi_params; #} After doing this, execute the following script:
/usr/share/hhvm/install_fastcgi.sh Executing this script configures Nginx to start using HHVM to process the PHP code. It&amp;rsquo;ll also restart the Nginx server so you don&amp;rsquo;t have to do anything else. Then you may want to tweak the max_upload_size of HHVM by editing /etc/hhvm/php.ini. Otherwise HHVM is now setup and working.
Verifying that HHVM is Working Correctly With Nginx and Ubuntu 14.04 It is important verify that HHVM is working with Nginx. You can verify this by creating a file in /usr/share/nginx/html called test.php. Paste this inside:
&amp;lt;?php echo defined(&#39;HHVM\_VERSION&#39;)?&#39;Using HHVM&#39;:&#39;Not using HHVM&#39;; ?&amp;gt; Visit http://you.rip.add.res/test.php to view the output. This will verify that HHVM is handling PHP. Now just make sure that HHVM and Nginx run by default at startup.
sudo update-rc.d nginx defaults sudo update-rc.d hhvm defaults You are ready to move on to the next part of this tutorial.
]]></content:encoded></item><item><title>Installing WordPress with Nginx on Ubuntu 14.04</title><link>https://bryanapperson.com/blog/installing-wordpress-with-nginx-on-ubuntu-14-04/</link><pubDate>Mon, 17 Feb 2020 23:10:08 UT</pubDate><dc:creator>Bryan Apperson</dc:creator><guid>https://bryanapperson.com/blog/installing-wordpress-with-nginx-on-ubuntu-14-04/</guid><description>Installing WordPress with Nginx on Ubuntu 14.04 is a fairly straightforward task. In this tutorial we will do over how to do it. This tutorial assumes you have completed the Getting Started with an Ubuntu VPS guide and have an Ubuntu 14.04 VPS (if not you can get one at vultr). It also assumes that you already have a LEMP stack setup (Linux, Nginx, MySQL, etcetera) or you are following the WordPress HHVM guide.</description><content:encoded><![CDATA[Installing WordPress with Nginx on Ubuntu 14.04 is a fairly straightforward task. In this tutorial we will do over how to do it. This tutorial assumes you have completed the Getting Started with an Ubuntu VPS guide and have an Ubuntu 14.04 VPS (if not you can get one at vultr). It also assumes that you already have a LEMP stack setup (Linux, Nginx, MySQL, etcetera) or you are following the WordPress HHVM guide. This tutorial assumes the use of Nginx as the web server, Fastcgi or HHVM for PHP and either MariaDB or MySQL for your MySQL server. The first step in this tutorial is to connect to your virtual machine via SSH. This tutorial assumes that you are using Linux as your operating system and have SSH installed. If you do not you can use a tool like Putty for SSH. In Linux you just need to run the following command:
ssh -p port user@you.rip.add.res After connecting to your instance via SSH it is time to begin the process of installing WordPress to work with Nginx. All of our tutorials for Nginx assume a &amp;ldquo;web root&amp;rdquo; of /var/www/html, make sure that your Nginx configuration points there and that the directory exists. If the directory does not exist create it using mkdir and chown it to www-data .
sudo mkdir /var/www/ sudo mkdir /var/www/html/ sudo chown -R www-data:www-data /var/www/html/ Creating a Database and User After you have confirmed that Nginx is using /var/www/html/ as your web root or setup another of your choice, it&amp;rsquo;s time to create a database for WordPress. Please make sure you have already setup MySQL or MariaDB prior to this step. Setting up the database is easy. Start by logging into an interactive session with the MySQL administrative account.
mysql -u root -p You will be prompted for the root password you setup during MySQL installation. Enter it and proceed to the interactive prompt. Next we are going to create a database for WordPress to use and store information in. The name of the database does not matter, but it should be memorable so that you can distinguish it as you add additional databases later on. To do this simply run this command:
CREATE DATABASE wordpress; Note the semi-colon (;) that ends the MySQL statement. Every MySQL statement must end with one, so check that if you are running into issues. Now that you have created a database, we need to create a user. You are going to use the same interactive interface you are in now to create a user. Use this command:
CREATE USER wordpressuser@localhost IDENTIFIED BY &#39;password&#39;; Make sure you replace &amp;lsquo;password&amp;rsquo; with the database password you want to use and &amp;lsquo;wordpressuser&amp;rsquo; with the name of the database user you want to create. After that is done you need to assign that user privileges to use the database we just created. Use this command:
GRANT ALL PRIVILEGES ON wordpress.\* TO wordpressuser@localhost; Make sure you replace the database name and username with the ones you created. Everything should now be configured correctly. We need to flush the privileges (save them to disk) so that our current instance of MySQL knows about the privilege changes we have made:
FLUSH PRIVILEGES; Now you can exit MySQL:
exit
At this point you are back at the shell command prompt and ready to continue.
Installing WordPress with Nginx on Ubuntu 14.04 The next step is to download the latest version of WordPress to the server. It is available on their website. We are going to use the wget command to copy it to our home directory. WordPress always keeps the latest stable version at the place we will use in this command.
cd ~ wget http://wordpress.org/latest.tar.gz The files which compose WordPress were downloaded as a compressed archive stored in a file called latest.tar.gz. We can extract the contents by typing:
tar xzvf latest.tar.gz This will extract a directory called wordpress containing all the files we need to set up WordPress. First however make sure that php5-gd and libssh2-php are installed. If they are not, run the command below. This will make sure you can work with images and install modules/plugins over SSH.
sudo apt-get update sudo apt-get install php5-gd libssh2-php Configuring WordPress with Nginx on Ubuntu 14.04 Now we are ready to configure WordPress and move it into the web root. Let&amp;rsquo;s move into the directory that we extracted WordPress to in the last section:
cd ~/wordpress Now we want to copy the sample configuration to take the place of the non-existent main configuration.
cp wp-config-sample.php wp-config.php
Next we need to make 3 small changes to wp-config.php using nano or your text editor of choice.
nano wp-config.php
The file is suitable for launching WordPress; it is just lacking the information to connect to the database we created a few minutes ago. The parameters we need to set are DB_NAME , DB_USER , and DB_PASSWORD . After you make the changes to that section of the file it should look something like this:
// ** MySQL settings - You can get this info from your web host ** // /** The name of the database for WordPress */ define(&#39;DB_NAME&#39;, &#39;wordpress&#39;); /** MySQL database username */ define(&#39;DB_USER&#39;, &#39;wordpressuser&#39;); /** MySQL database password */ define(&#39;DB_PASSWORD&#39;, &#39;password&#39;); For now you can ignore the rest of the site. If you are planning on deploying a multisite network add this line:
/* Multisite */ define( &amp;lsquo;WP_ALLOW_MULTISITE&amp;rsquo;, true );
Once you have made these changes you can save and close the file. Now it is time to copy the files to our web root (/var/www/html/ in this example). We can copy the files to this place by typing:
sudo rsync -avP ~/wordpress/ /var/www/html/ Now we need to move over to that folder to assign some permissions.
cd /var/www/html/ Then we are going to make sure that Nginx owns these files so that it can manipulate them.
sudo chown -R www-data:www-data /var/www/html/*
Before we move on, we should create a new directory for user uploads:
mkdir wp-content/uploads The new directory should have group writing set already, but the new directory isn&amp;rsquo;t assigned with www-data group ownership yet. Let&amp;rsquo;s fix that:
sudo chown -R :www-data /var/www/html/wp-content/uploads Now just make sure that your web server is configured to use /var/www/html/ as the webroot and you can visit yourdomain.com to set your site name and get started. You are also going to want to install Postfix so that WordPress can send emails. We will be writing a tutorial for that in the near future. Thanks for reading and leave your thoughts in the comments below.
]]></content:encoded></item><item><title>Configure Nginx/HHVM for WP - Making WordPress Fly</title><link>https://bryanapperson.com/blog/configure-nginx-hhvm-for-wp-making-wordpress-fly/</link><pubDate>Mon, 17 Feb 2020 20:40:54 UT</pubDate><dc:creator>Bryan Apperson</dc:creator><guid>https://bryanapperson.com/blog/configure-nginx-hhvm-for-wp-making-wordpress-fly/</guid><description>The next step in the tutorial &amp;ldquo;Making WordPress Fly&amp;rdquo; is to configure Nginx/HHVM and install WordPress. This step has two options, configuring for single site (this article) or configuring for multisite. This tutorial will assume that you have completed the prerequisites and read the introduction (part one). It will also that you have completed both parts two and three. We will also assume that you have an Ubuntu VPS. If you don&amp;rsquo;t, you can get one at Vultr.</description><content:encoded><![CDATA[The next step in the tutorial &amp;ldquo;Making WordPress Fly&amp;rdquo; is to configure Nginx/HHVM and install WordPress. This step has two options, configuring for single site (this article) or configuring for multisite. This tutorial will assume that you have completed the prerequisites and read the introduction (part one). It will also that you have completed both parts two and three. We will also assume that you have an Ubuntu VPS. If you don&amp;rsquo;t, you can get one at Vultr. At this point you should have your VPS secured. You should also have MariaDB, Nginx, and HHVM installed. The first step in this section is to reconnect to your VM via SSH.
ssh -p port user@you.rip.add.res
After connecting to your instance, we are going to create a location to install WordPress. We are going to use /var/www/html however you can use a different directory like /var/www/html/domain-com/ if you choose to. Be aware that you will have to update the configurations to match if you choose a different directory structure. Creating the new directory is straightforward.
sudo mkdir /var/www/html/
We need to install WordPress to /var/www/html . The guide for that can be found here. Once you have completed that, you are ready to move on to the next step. Configuring Nginx for Multisite WordPress with W3 Total cache is the most involved part of the &amp;ldquo;Making WordPress Fly&amp;rdquo; series. At this point we are going to assume that you have been following the series since the beginning. We are also going to assume you already have an Ubuntu VPS. So far we have secured an Ubuntu VPS, setup MariaDB, installed HHVM and installed Nginx. Now we are ready for part 4a, to configure Nginx to work with WordPress Multisite and W3 Total Cache. Part 4b is the alternative if you only need a single site WordPress install on your HHVM enhanced, WordPress optimized VPS. Choosing a multisite install definitely makes sense as you can use this VPS to host more then a few sites, even if the get significant traffic.
That&amp;rsquo;s all for now.
]]></content:encoded></item><item><title>HHVM, MariaDB and Nginx Make WordPress Fly - Intro</title><link>https://bryanapperson.com/blog/hhvm-mariadb-and-nginx-make-wordpress-fly-intro/</link><pubDate>Mon, 17 Feb 2020 20:17:30 UT</pubDate><dc:creator>Bryan Apperson</dc:creator><guid>https://bryanapperson.com/blog/hhvm-mariadb-and-nginx-make-wordpress-fly-intro/</guid><description>HHVM, MariaDB and Nginx Make WordPress fly (seriously). This site is running on what may the fastest possible software stack for WordPress. That stack is HHVM, MariaDB 10.1, Nginx and Ubuntu 14.04. As you are browsing this site you may notice that it is graphically intensive. It also leverages many CPU hungry plugins that would make it take 6-10 seconds to load on even good shared hosting. With this aforementioned software stack pages up to 5MB on this site still load in under a second, end-user pipe permitting.</description><content:encoded><![CDATA[HHVM, MariaDB and Nginx Make WordPress fly (seriously). This site is running on what may the fastest possible software stack for WordPress. That stack is HHVM, MariaDB 10.1, Nginx and Ubuntu 14.04. As you are browsing this site you may notice that it is graphically intensive. It also leverages many CPU hungry plugins that would make it take 6-10 seconds to load on even good shared hosting. With this aforementioned software stack pages up to 5MB on this site still load in under a second, end-user pipe permitting. This is all happening on a VPS with 2 x 2.26Ghz cores and 2GB of RAM. Not only that but this stack can serve over 1000 2MB WordPress pages per second without losing stability:
AB BenchMark [user@host ~]# ab -c 50 -n 5000 http://bryanapperson.com/ This is ApacheBench, Version 2.3 &amp;lt;$Revision: 655654 $&amp;gt; Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/ Licensed to The Apache Software Foundation, http://www.apache.org/ Benchmarking bryanapperson.com (be patient) Completed 500 requests Completed 1000 requests Completed 1500 requests Completed 2000 requests Completed 2500 requests Completed 3000 requests Completed 3500 requests Completed 4000 requests Completed 4500 requests Completed 5000 requests Finished 5000 requests Server Software: nginx Server Hostname: bryanapperson.com Server Port: 80 Document Path: / Document Length: 16138 bytes Concurrency Level: 50 Time taken for tests: 3.916 seconds Complete requests: 5000 Failed requests: 0 Write errors: 0 Total transferred: 83046606 bytes HTML transferred: 80706138 bytes Requests per second: 1276.68 \[#/sec\](mean) Time per request: 39.164 \[ms\](mean) Time per request: 0.783 \[ms\] (mean, across all concurrent requests) Transfer rate: 20707.77 \[Kbytes/sec\] received Connection Times (ms) min mean\[&#43;/-sd\] median max Connect: 1 1 0.2 1 5 Processing: 12 38 8.1 37 88 Waiting: 11 37 8.1 36 87 Total: 14 39 8.1 38 89 Percentage of the requests served within a certain time (ms) 50% 38 66% 41 75% 43 80% 44 90% 49 95% 54 98% 60 99% 66 100% 89 (longest request) Why HHVM for WordPress? So you may be asking yourself, is that really possible? Yes, HHVM and WordPress work very well together. If you asked me a few days ago I might have said no. But after playing around with HHVM, also known as &amp;ldquo;Hip Hop for PHP&amp;rdquo;, it is. HHVM is Facebook&amp;rsquo;s production PHP server which has now gone open source. At this point it still has a few compatibility issues. Especially with the usual culprits like Ioncube. However it works very well with WordPress 3.9&#43;. When combined with Nginx, MariaDB and Ubuntu &amp;ldquo;Trust Tahr&amp;rdquo; you get a pretty unbeatable platform for WordPress. Serving 200 request per second even on un-cached and heavy pages where PHP-FPM can only achieve 18 requests per second on a VM with the same resources (rendering the same un-cached pages).
MariaDB 10.1 MariaDB provides a solid database back-end and can easily be scaled out into a Galera Cluster for larger deployments. MariaDB 10.1 outperforms MySQL 5.7.4 by a significant margin, that is why it was chosen for this stack and it proved itself in implementation. MariaDB would perform better on SSD if available, but the above results were achieved on RAID10 7200RPM SATAIII with an LSI Megaraid BBU controller (512MB Cache).
Nginx Nginx can be somewhat less intuitive to configure then Apache. However it is a beast for serving static files especially per resource usage when configured correctly. Which is mostly what it does in this stack as all PHP processing is done by HHVM. Nginx really shines in serving static files to many user concurrently with the configuration we&amp;rsquo;ll outline in the coming articles.
Ubuntu 14.04 &amp;ldquo;Trusty Tahr&amp;rdquo; Choosing Ubuntu 14.04 for this deployment made sense, because it is LTS (5 years of support) and apt-get makes it almost trivial to get all of this setup. Not to mention that Ubuntu is a stable OS (although I usually prefer CentOS/RHEL). Nginx is built into the native repos for Ubuntu 14.04 and having maintained repos for both HHVM and MariaDB with Ubuntu 14.04 makes this stack easy to update later on. If you need an Ubuntu VPS you can get one for here. Before you get started with this you will probably want to secure your Ubuntu VPS.
WordPress 3.9.2 This series of articles will show you how to set all of this up and make it work with both a WordPress multi-site network, and a single WordPress site. I used the multi-site network with WP MU Domain Mapper and Nginx helper for ease of moving my multiple blogs and family/friends WordPress sites on to one platform. We will also be leveraging W3 Total Cache and APC (which is built in to HHVM) for Opcode caching.
Concluding the Introduction This setup is so efficient you wouldn&amp;rsquo;t need to scale out past a single VM instance unless you were in the Alexa top 10000, so we won&amp;rsquo;t handle that in this series. In articles to follow I will layout how to build this stack and use it for Lightning fast WordPress hosting on a shoestring budget. You&amp;rsquo;ll be able to handle 50,000 page loads an hour or more on a 2GB RAM Xen VM. I will update this article with links to the upcoming tutorials.
]]></content:encoded></item></channel></rss>
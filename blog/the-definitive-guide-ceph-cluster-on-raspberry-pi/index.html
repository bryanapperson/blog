<!doctype html><html lang=en-us><head><meta http-equiv=content-security-policy content="default-src 'self' https: 'unsafe-inline' 'unsafe-eval'; worker-src 'self' blob:; connect-src 'self' wss: data:; font-src 'self' https: data:; img-src 'self' https: data:; object-src 'none'"><meta name=generator content="After Dark Hugo"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>The Definitive Guide: Ceph Cluster on Raspberry Pi | Bryan Apperson</title><meta name=description content="Learn how to deploy a ceph cluster on a Raspberry Pi. Commodity off the shelf hardware meets a budget."><meta name=keywords content="arm,ceph,rados,raspberry-pi,storage"><meta property="og:title" content="The Definitive Guide: Ceph Cluster on Raspberry Pi"><meta property="og:description" content="Learn how to deploy a ceph cluster on a Raspberry Pi. Commodity off the shelf hardware meets a budget."><meta property="og:type" content="article"><meta property="og:url" content="https://bryanapperson.com/blog/the-definitive-guide-ceph-cluster-on-raspberry-pi/"><meta property="og:image" content="https://source.unsplash.com/collection/983219/2000x1322"><meta property="article:section" content="blog"><meta property="article:published_time" content="2015-05-13T01:35:35+00:00"><meta property="article:modified_time" content="2020-02-17T20:58:50+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://source.unsplash.com/collection/983219/2000x1322"><meta name=twitter:title content="The Definitive Guide: Ceph Cluster on Raspberry Pi"><meta name=twitter:description content="Learn how to deploy a ceph cluster on a Raspberry Pi. Commodity off the shelf hardware meets a budget."><meta property="og:image" content="https://source.unsplash.com/collection/983219/2000x1322"><meta name=referrer content="same-origin"><script integrity="sha512-2t0yyNrUdtn9WGIoBVxq5vtoJQYfoDQDbqRPpOb75f1hiL39DGLdJKDrGP60fBhXfrFeKyVhzWJvHvLgln/ElA==">/*! Fetch Inject v2.0.4 | Copyright (C) Josh Habdas <jhabdas@protonmail.com> (https://habd.as) | @license Zlib */var fetchInject=function(){"use strict";const a=function(g,c,d,e,f,a,b){a=c.createElement(d),b=c.getElementsByTagName(d)[0],a.appendChild(c.createTextNode(e.text)),a.onload=f(e),b?b.parentNode.insertBefore(a,b):c.head.appendChild(a)};return function(f,b){if(!arguments.length)return Promise.reject(new ReferenceError("Failed to execute 'fetchInject': 1 argument required but only 0 present."));if(arguments[0]&&arguments[0].constructor!==Array)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 1 must be of type 'Array'."));if(arguments[1]&&arguments[1].constructor!==Promise)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 2 must be of type 'Promise'."));const c=[],d=b?[].concat(b):[],e=[];return f.forEach(a=>d.push(window.fetch(a).then(a=>[a.clone().text(),a.blob()]).then(a=>Promise.all(a).then(a=>{c.push({text:a[0],blob:a[1]})})))),Promise.all(d).then(()=>(c.forEach(b=>{e.push({then:c=>{b.blob.type.includes("text/css")?a(window,document,"style",b,c):a(window,document,"script",b,c)}})}),Promise.all(e)))}}()</script><script integrity="sha512-2XlvnxweZhaHgBdCoOK0PoCUWiSfKibb+RCRZNgqLdvbnx0ZH67FDGKQqmpqCerjMJbZFv6fsXgbmJOOA9K+qA==">/*!
 * Copyright (C) 2019  Josh Habdas <jhabdas@protonmail.com>
 *
 * This file is part of After Dark.
 *
 * After Dark is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published
 * by the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * After Dark is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */fetchInject(["/js/lazysizes.min.js"])</script><meta title=mod:fractal-forest content="status:enabled"><script async src=/js/bpgdec8a.js integrity="sha384-8PG0go3BW8hLm63KbTxk/hNcehaoSbrAhKzsmy2Jhs/KY8QdiKKkjhdeyHY/Q/0I
"></script><link rel=canonical href=https://bryanapperson.com/blog/the-definitive-guide-ceph-cluster-on-raspberry-pi/><link rel=icon sizes=any href="data:image/svg+xml,%3Csvg viewBox=%220 0 46 45%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Ctitle%3EAfter Dark%3C/title%3E%3Cpath d=%22M.708 45 23 .416 45.292 45H.708zM35 38 23 19 11 38h24z%22 fill=%22%23000%22/%3E%3C/svg%3E"><style>html{font-size:12px}*{box-sizing:border-box;text-rendering:geometricPrecision}body{font-size:1rem;line-height:1.5rem;margin:0;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;word-wrap:break-word}h1,h2,h3,h4,h5,h6{line-height:1.3em}fieldset{border:none;padding:0;margin:0}pre{padding:2rem;margin:1.75rem 0;background-color:#fff;border:1px solid #ccc;overflow:auto}code[class*=language-],pre[class*=language-],pre code{font-weight:100;text-shadow:none;margin:1.75rem 0}a{cursor:pointer;color:#ff2e88;text-decoration:none;border-bottom:1px solid #ff2e88}a:hover{background-color:#ff2e88;color:#fff}.grid{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.grid.\-top{-ms-flex-align:start;align-items:flex-start}.grid.\-middle{-ms-flex-align:center;align-items:center}.grid.\-bottom{-ms-flex-align:end;align-items:flex-end}.grid.\-stretch{-ms-flex-align:stretch;align-items:stretch}.grid.\-baseline{-ms-flex-align:baseline;align-items:baseline}.grid.\-left{-ms-flex-pack:start;justify-content:flex-start}.grid.\-center{-ms-flex-pack:center;justify-content:center}.grid.\-right{-ms-flex-pack:end;justify-content:flex-end}.grid.\-between{-ms-flex-pack:justify;justify-content:space-between}.grid.\-around{-ms-flex-pack:distribute;justify-content:space-around}.cell{-ms-flex:1;flex:1;box-sizing:border-box}@media screen and (min-width:768px){.cell.\-1of12{-ms-flex:0 0 8.33333%;flex:0 0 8.33333%}.cell.\-2of12{-ms-flex:0 0 16.66667%;flex:0 0 16.66667%}.cell.\-3of12{-ms-flex:0 0 25%;flex:0 0 25%}.cell.\-4of12{-ms-flex:0 0 33.33333%;flex:0 0 33.33333%}.cell.\-5of12{-ms-flex:0 0 41.66667%;flex:0 0 41.66667%}.cell.\-6of12{-ms-flex:0 0 50%;flex:0 0 50%}.cell.\-7of12{-ms-flex:0 0 58.33333%;flex:0 0 58.33333%}.cell.\-8of12{-ms-flex:0 0 66.66667%;flex:0 0 66.66667%}.cell.\-9of12{-ms-flex:0 0 75%;flex:0 0 75%}.cell.\-10of12{-ms-flex:0 0 83.33333%;flex:0 0 83.33333%}.cell.\-11of12{-ms-flex:0 0 91.66667%;flex:0 0 91.66667%}}@media screen and (max-width:768px){.grid{-ms-flex-direction:column;flex-direction:column}.cell{-ms-flex:0 0 auto;flex:none}}.hack,.hack blockquote,.hack code,.hack em,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack strong{font-size:1rem;font-style:normal;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif}.hack blockquote,.hack code,.hack em,.hack strong{line-height:20px}.hack blockquote,.hack code,.hack footer,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack header,.hack li,.hack ol,.hack p,.hack section,.hack ul{float:none;margin:0;padding:0}.hack blockquote,.hack h1,.hack ol,.hack p,.hack ul{margin-top:20px;margin-bottom:20px}.hack h1{position:relative;display:inline-block;display:table-cell;padding:20px 0 30px;margin:0;overflow:hidden}.hack h1:after{content:"====================================================================================================";position:absolute;bottom:10px;left:0}.hack h1+*{margin-top:0}.hack h2,.hack h3,.hack h4,.hack h5,.hack h6{position:relative;margin-bottom:1.75rem}.hack h2:before,.hack h3:before,.hack h4:before,.hack h5:before,.hack h6:before{display:inline}.hack h2:before{content:"## "}.hack h3:before{content:"### "}.hack h4:before{content:"#### "}.hack h5:before{content:"##### "}.hack h6:before{content:"###### "}.hack li{position:relative;display:block;padding-left:20px}.hack li:after{position:absolute;top:0;left:0}.hack ul>li:after{content:"-"}.hack ol{counter-reset:a}.hack ol>li:after{content:counter(a)".";counter-increment:a}.hack ol li:nth-child(n+10):after{left:-7px}.hack blockquote{position:relative;padding-left:17px;padding-left:2ch;overflow:hidden}.hack blockquote:after{content:">\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>";white-space:pre;position:absolute;top:0;left:0;line-height:20px}.hack em:after,.hack em:before{content:"*";display:inline}.hack pre code:after,.hack pre code:before{content:""}.hack code{font-weight:700}.hack code:after,.hack code:before{content:"`";display:inline}.hack hr{position:relative;height:20px;overflow:hidden;border:0;margin:20px 0}.hack hr:after{content:"----------------------------------------------------------------------------------------------------";position:absolute;top:0;left:0;line-height:20px;width:100%;word-wrap:break-word}@-moz-document url-prefix(){.hack h1{display:block}}.hack-ones ol>li:after{content:"1."}p{margin:0 0 1.75rem}.container{max-width:70rem}.container,.container-fluid{margin:0 auto;padding:0 1rem}.inner{padding:1rem}.inner2x{padding:2rem}.pull-left{float:left}.pull-right{float:right}.progress-bar{height:8px;opacity:.8;background-color:#ccc;margin-top:12px}.progress-bar.progress-bar-show-percent{margin-top:38px}.progress-bar-filled{background-color:gray;height:100%;transition:width .3s ease;position:relative;width:0}.progress-bar-filled:before{content:"";border:6px solid transparent;border-top-color:gray;position:absolute;top:-12px;right:-6px}.progress-bar-filled:after{color:gray;content:attr(data-filled);display:block;font-size:12px;white-space:nowrap;position:absolute;border:6px solid transparent;top:-38px;right:0;-ms-transform:translateX(50%);transform:translateX(50%)}table{width:100%;border-collapse:collapse;margin:1.75rem 0;color:#778087}table td,table th{vertical-align:top;border:1px solid #ccc;line-height:15px;padding:10px}table thead th{font-size:10px}table tbody td:first-child{font-weight:700;color:#333}.form{width:30rem}.form-group{margin-bottom:1.75rem;overflow:auto}.form-group label{border-bottom:2px solid #ccc;color:#333;width:10rem;display:inline-block;height:38px;line-height:38px;padding:0;float:left;position:relative}.form-group.form-success label{color:#4caf50!important;border-color:#4caf50!important}.form-group.form-warning label{color:#ff9800!important;border-color:#ff9800!important}.form-group.form-error label{color:#f44336!important;border-color:#f44336!important}.form-control{outline:none;border:none;border-bottom:2px solid #ccc;padding:.5rem 0;width:20rem;height:38px;background-color:initial}.form-control:focus{border-color:#555}.form-group.form-textarea label:after{position:absolute;content:"";width:2px;background-color:#fff;right:-2px;top:0;bottom:0}textarea.form-control{height:auto;resize:none;padding:1rem 0;border-bottom:2px solid #ccc;border-left:2px solid #ccc;padding:.5rem}select.form-control{border-radius:0;background-color:initial;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none}.help-block{color:#999;margin-top:.5rem}.form-actions{margin-bottom:1.75rem}.btn{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;cursor:pointer;outline:none;padding:.65rem 2rem;font-size:1rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;z-index:1}.btn:active{box-shadow:inset 0 1px 3px rgba(0,0,0,.12)}.btn.btn-ghost{border-color:#757575;color:#757575;background-color:initial}.btn.btn-ghost:focus,.btn.btn-ghost:hover{border-color:#424242;color:#424242;z-index:2}.btn.btn-ghost:hover{background-color:initial}.btn-block{width:100%;display:-ms-flexbox;display:flex}.btn-default{color:#fff;background-color:#e0e0e0;border:1px solid #e0e0e0;color:#333}.btn-default:focus:not(.btn-ghost),.btn-default:hover{background-color:#dcdcdc;border-color:#dcdcdc}.btn-success{color:#fff;background-color:#4caf50;border:1px solid #4caf50}.btn-success:focus:not(.btn-ghost),.btn-success:hover{background-color:#43a047;border-color:#43a047}.btn-success.btn-ghost{border-color:#4caf50;color:#4caf50}.btn-success.btn-ghost:focus,.btn-success.btn-ghost:hover{border-color:#388e3c;color:#388e3c;z-index:2}.btn-error{color:#fff;background-color:#f44336;border:1px solid #f44336}.btn-error:focus:not(.btn-ghost),.btn-error:hover{background-color:#e53935;border-color:#e53935}.btn-error.btn-ghost{border-color:#f44336;color:#f44336}.btn-error.btn-ghost:focus,.btn-error.btn-ghost:hover{border-color:#d32f2f;color:#d32f2f;z-index:2}.btn-warning{color:#fff;background-color:#ff9800;border:1px solid #ff9800}.btn-warning:focus:not(.btn-ghost),.btn-warning:hover{background-color:#fb8c00;border-color:#fb8c00}.btn-warning.btn-ghost{border-color:#ff9800;color:#ff9800}.btn-warning.btn-ghost:focus,.btn-warning.btn-ghost:hover{border-color:#f57c00;color:#f57c00;z-index:2}.btn-info{color:#fff;background-color:#00bcd4;border:1px solid #00bcd4}.btn-info:focus:not(.btn-ghost),.btn-info:hover{background-color:#00acc1;border-color:#00acc1}.btn-info.btn-ghost{border-color:#00bcd4;color:#00bcd4}.btn-info.btn-ghost:focus,.btn-info.btn-ghost:hover{border-color:#0097a7;color:#0097a7;z-index:2}.btn-primary{color:#fff;background-color:#2196f3;border:1px solid #2196f3}.btn-primary:focus:not(.btn-ghost),.btn-primary:hover{background-color:#1e88e5;border-color:#1e88e5}.btn-primary.btn-ghost{border-color:#2196f3;color:#2196f3}.btn-primary.btn-ghost:focus,.btn-primary.btn-ghost:hover{border-color:#1976d2;color:#1976d2;z-index:2}.btn-group{overflow:auto}.btn-group .btn{float:left}.btn-group .btn-ghost:not(:first-child){margin-left:-1px}.card{border:1px solid #ccc}.card .card-header{color:#333;text-align:center;background-color:#ddd;padding:.5rem 0}.alert{color:#ccc;padding:1rem;border:1px solid #ccc;margin-bottom:1.75rem}.alert-success{color:#4caf50;border-color:#4caf50}.alert-error{color:#f44336;border-color:#f44336}.alert-info{color:#00bcd4;border-color:#00bcd4}.alert-warning{color:#ff9800;border-color:#ff9800}.media:not(:last-child){margin-bottom:1.25rem}.media-left{padding-right:1rem}.media-left,.media-right{display:table-cell;vertical-align:top}.media-right{padding-left:1rem}.media-body{display:table-cell;vertical-align:top}.media-heading{font-size:1.16667rem;font-weight:700}.media-content{margin-top:.3rem}.avatarholder,.placeholder{background-color:#f0f0f0;text-align:center;color:#b9b9b9;font-size:1rem;border:1px solid #f0f0f0}.avatarholder{width:48px;height:48px;line-height:46px;font-size:2rem;background-size:cover;background-position:50%;background-repeat:no-repeat}.avatarholder.rounded{border-radius:33px}.loading{display:inline-block;content:"&nbsp;";height:20px;width:20px;margin:0 .5rem;animation:a .6s infinite linear;border:2px solid #e91e63;border-right-color:transparent;border-radius:50%}.btn .loading{margin-bottom:0;width:14px;height:14px}.btn div.loading{float:left}.alert .loading{margin-bottom:-5px}@keyframes a{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.menu{width:100%}.menu .menu-item{display:block;color:#616161;border-color:#616161}.menu .menu-item.active,.menu .menu-item:hover{color:#000;border-color:#000;background-color:initial}@media screen and (max-width:768px){.form-group label{display:block;border-bottom:none;width:100%}.form-group.form-textarea label:after{display:none}.form-control{width:100%}textarea.form-control{border-left:none;padding:.5rem 0}pre::-webkit-scrollbar{height:3px}}@media screen and (max-width:480px){.form{width:100%}}.dark{color:#ccc}.dark,.dark pre{background-color:#000}.dark pre{padding:0;border:none}.dark pre code{color:#00bcd4}.dark h1 a,.dark h2 a,.dark h3 a,.dark h4 a,.dark h5 a{color:#ccc}.dark code,.dark strong{color:#fff}.dark code{font-weight:100}.dark table{color:#ccc}.dark table td,.dark table th{border-color:#444}.dark table tbody td:first-child{color:#fff}.dark .form-group label{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-group.form-textarea label:after{background-color:#000}.dark .form-control{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-control:focus{border-color:#ccc;color:#ccc}.dark textarea.form-control{color:#ccc}.dark .card{border-color:rgba(95,95,95,.78)}.dark .card .card-header{background-color:initial;color:#ccc;border-bottom:1px solid rgba(95,95,95,.78)}.dark .btn.btn-ghost.btn-default{border-color:#ababab;color:#ababab}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#9c9c9c;color:#9c9c9c;z-index:1}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#e0e0e0;color:#e0e0e0}.dark .btn.btn-ghost.btn-primary:focus,.dark .btn.btn-ghost.btn-primary:hover{border-color:#64b5f6;color:#64b5f6}.dark .btn.btn-ghost.btn-success:focus,.dark .btn.btn-ghost.btn-success:hover{border-color:#81c784;color:#81c784}.dark .btn.btn-ghost.btn-info:focus,.dark .btn.btn-ghost.btn-info:hover{border-color:#4dd0e1;color:#4dd0e1}.dark .btn.btn-ghost.btn-error:focus,.dark .btn.btn-ghost.btn-error:hover{border-color:#e57373;color:#e57373}.dark .btn.btn-ghost.btn-warning:focus,.dark .btn.btn-ghost.btn-warning:hover{border-color:#ffb74d;color:#ffb74d}.dark .avatarholder,.dark .placeholder{background-color:initial;border-color:#333}.dark .menu .menu-item{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .menu .menu-item.active,.dark .menu .menu-item:hover{color:#fff;border-color:#ccc}/*!* Copyright (C) 2019 Josh Habdas <jhabdas@protonmail.com>
*
* This file is part of After Dark.
*
* After Dark is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as published
* by the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* After Dark is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU Affero General Public License for more details.
*
* You should have received a copy of the GNU Affero General Public License
* along with this program. If not, see <https://www.gnu.org/licenses/>.*/:root{scroll-behavior:smooth;--screen-size-small:30em}@keyframes intro{0%{opacity:0}100%{opacity:1}}.blur-up.lazyloading{filter:blur(5px);opacity:1;transition:opacity 1s,filter 1.5s}.blur-up.lazyload{opacity:0;filter:blur(10px)}.blur-up.lazyloaded{filter:blur(0);transition:filter 1s}.hack .readmore{margin-bottom:2.2em}.responsive-iframe,.ratio-container{position:relative;padding-bottom:56.25%;padding-top:25px;height:0}.responsive-iframe iframe,.ratio-container>*:not([itemprop=caption]){position:absolute;top:0;left:0;width:100%;height:100%}iframe{border:0}main,footer{animation:intro .3s both;animation-delay:.15s}header:first-of-type+details{margin:20px 0}footer time[datetime$=M]:before{content:"\2013\0020"}body>footer p.muted{margin-bottom:0}@media only screen and (max-width:768px){footer time[datetime$=M]{display:none}}blockquote cite{display:block}blockquote cite::before{content:"\2014\00A0"}:target{filter:brightness(1.2)}:disabled{cursor:not-allowed}.hack li ul{margin:0}.hack ol li{padding-left:27px}.main{padding:20px 10px}input.form-control{border-radius:0;background-color:initial;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none}input.form-control,textarea.form-control,select.form-control,.help-block{font-size:initial}@media only screen and (max-width:768px){.help-block{font-size:unset}}html{font-size:13px}.hack .form input,.hack .form textarea,.hack .form button,.hack .form label{font-size:1rem}.hack .alert .highlight:first-of-type .chroma,.hack .card .highlight:first-of-type .chroma,.hack .alert pre:first-of-type,.hack .alert p:first-of-type,.hack .card pre:first-of-type,.hack .card p:first-of-type{margin-top:unset}.hack .alert .highlight:last-of-type .chroma,.hack .card .highlight:last-of-type .chroma,.hack .alert pre:last-of-type,.hack .alert p:last-of-type,.hack .card pre:last-of-type,.hack .card p:last-of-type{margin-bottom:unset}.hack blockquote,.hack blockquote:after{line-height:1.5}.hack figure,.standard figure{margin:unset}.hack figure a{border-bottom:none}.hack figure a:hover{background-color:inherit}article header img{width:100%;border-radius:3px}table td,table th{line-height:inherit}table a{border-bottom:unset}img{max-width:100%}@media only screen and (min-width:768px){html{font-size:16px}.container{max-width:50rem}}@media only screen and (min-width:768px),(-ms-high-contrast:active),(-ms-high-contrast:none){html{margin-left:calc(100vw - 100%)}}/*!* Copyright (C) 2019 Josh Habdas <jhabdas@protonmail.com>
*
* This file is part of After Dark.
*
* After Dark is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as published
* by the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* After Dark is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU Affero General Public License for more details.
*
* You should have received a copy of the GNU Affero General Public License
* along with this program. If not, see <https://www.gnu.org/licenses/>.*/a[rel*=external]::after{content:" " url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 class=%22i-external%22 viewBox=%220 0 32 32%22 width=%2214%22 height=%2214%22 fill=%22none%22 stroke=%22%23ff9800%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22 stroke-width=%229.38%25%22%3E%3Cpath d=%22M14 9H3V29H23V18M18 4H28V14M28 4 14 18%22/%3E%3C/svg%3E")}nav a.active{background-color:inherit;color:#fff}a[itemprop=url]{color:#ff9800}a[itemprop=url]:hover{color:#fff}.muted,.help-block{opacity:.7}.hack .muted,.hack .help-block{color:#e0e0e0}.highlighttable td,th{padding:0;border:0}td.code{width:95%}.form-group{position:relative;padding-top:1.5rem}fieldset{border:0}input{width:100%;padding:12px 20px;margin:8px 0;border:2px solid #ccc;border-radius:4px;background-color:#f8f8f8;box-sizing:border-box}textarea{width:100%;height:150px;padding:12px 20px;box-sizing:border-box;border:2px solid #ccc;border-radius:4px;background-color:#f8f8f8;resize:none}input[type=button],input[type=submit],input[type=reset]{background-color:#212121;border:none;color:#fafafa;padding:16px 32px;text-decoration:none;margin:4px 2px;cursor:pointer}.post-comments{margin-top:60px}.post-comment{padding:20px;margin-top:20px}.post-comment-header{margin-bottom:20px}.post-comment-avatar{display:inline-block;vertical-align:middle;border-radius:50%}.post-comment-info{display:inline-block;margin-left:20px;margin-bottom:0;vertical-align:middle}.post-comment-field{display:block;font:inherit;padding:10px;margin-top:20px;width:100%}.dialog{display:none;position:fixed;padding:25px;background-color:#fafafa;padding-top:20%;top:0;left:0;width:100%;height:100%;text-align:center}.dialog:target{display:block}</style><meta name=theme-color content="#000"><script integrity="sha512-ISTAV0GadOIz/NXXHOS+eCM0ysXVVHhQTlvA6LJxz/DeA5yIxm0Vqf5IE+WH0yuuXkayAKtoZkQ326nch5f/fg==">fetchInject(["/css/syntax.css"])</script><noscript><link href=/css/syntax.css rel=stylesheet></noscript></head><body class="hack dark main container"><header><nav itemscope itemtype=https://schema.org/SiteNavigationElement><meta itemprop=name content="Main Menu"><a itemprop=url href=/>Home</a>
<a itemprop=url class=active href=/blog/>Blogs</a>
<a itemprop=url href=/musings/>Musings</a>
<a itemprop=url rel=search href=/search/>Search</a></nav></header><main><style>{{ -}}.hack header figure[itemtype*=ImageObject]{position:relative}.hack header figure[itemtype*=ImageObject] figcaption{position:absolute;bottom:0;right:0;text-align:right;padding:15px;font-style:oblique;font-size:smaller;mix-blend-mode:soft-light}.hack header figure[itemtype*=ImageObject] [itemprop=headline]{font-weight:700}</style><article itemscope itemtype=https://schema.org/BlogPosting><meta itemprop=name content="The Definitive Guide: Ceph Cluster on Raspberry Pi"><meta itemprop=description content="Learn how to deploy a ceph cluster on a Raspberry Pi. Commodity off the shelf hardware meets a budget."><meta itemprop=datePublished content="2015-05-13T01:35:35+00:00"><meta itemprop=dateModified content="2020-02-17T20:58:50+00:00"><meta itemprop=wordCount content="2980"><meta itemprop=image content="https://source.unsplash.com/collection/983219/2000x1322"><meta itemprop=keywords content="arm,ceph,rados,raspberry-pi,storage,"><header><h1 itemprop="headline name">The Definitive Guide: Ceph Cluster on Raspberry Pi</h1><p class=muted><svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%"><circle cx="16" cy="16" r="14"/><path d="M16 8v8l4 4"/></svg><span>14 minute read</span><svg style="margin-bottom:-3px" class="i-edit" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%"><path d="M30 7 25 2 5 22 3 29l7-2zM21 6l5 5zM5 22l5 5z"/></svg>
Modified: <time datetime=2020-02-17T20:58:50+00:00>17 Feb, 2020</time></p><blockquote itemprop=description>Learn how to deploy a ceph cluster on a Raspberry Pi. Commodity off the shelf hardware meets a budget.</blockquote></header><details><summary>Table of Contents</summary><nav id=TableOfContents><ul><li><ul><li><a href=#parts>Parts</a></li><li><a href=#operating-system>Operating System</a></li><li><a href=#hardware-limitations>Hardware Limitations</a></li><li><a href=#network>Network</a></li><li><a href=#object-storage-daemons>Object Storage Daemons</a><ul><li><a href=#osd-filesystem>OSD Filesystem</a></li></ul></li><li><a href=#installation>Installation</a><ul><li><a href=#uncomment-line-below-then-apt-get-update-to-enable-apt-get-source>Uncomment line below then &lsquo;apt-get update&rsquo; to enable &lsquo;apt-get source&rsquo;</a></li><li><a href=#uncomment-line-below-then-apt-get-update-to-enable-apt-get-source-1>Uncomment line below then &lsquo;apt-get update&rsquo; to enable &lsquo;apt-get source&rsquo;</a></li></ul></li><li><a href=#kernel-tweaks>Kernel Tweaks</a></li><li><a href=#imaging-the-os>Imaging the OS</a></li><li><a href=#imaging-your-nodes-os-drives>Imaging Your Nodes OS Drives</a></li><li><a href=#createa-ceph-cluster-on-raspberry-pi>Create a Ceph Cluster on Raspberry Pi</a><ul><li><a href=#creating-an-initial-ceph-configuration>Creating an initial Ceph Configuration</a></li><li><a href=#creating-initial-monitors>Creating Initial Monitors</a></li><li><a href=#creating-osds-object-storage-daemons>Creating OSDs (Object Storage Daemons)</a></li></ul></li><li><a href=#checking-cluster-health>Checking Cluster Health</a></li><li><a href=#what-to-do-now>What to do now?</a></li></ul></li></ul></nav></details><div itemprop=articleBody><p>A Ceph cluster on Raspberry Pi is an awesome way to create a RADOS home storage
solution (NAS) that is highly redundant and low power usage. It&rsquo;s also a low
cost way to get into Ceph, which may or may not be the future of storage
(software defined storage definitely is as a whole). Ceph on ARM is an
interesting idea in and of itself. I built one of these as a development
environment (playground) for home.  It can be done on a relatively small budget.
Since this was a spur of the moment idea, I purchased everything locally. I
opted for the
<a href=https://www.raspberrypi.org/products/raspberry-pi-2-model-b/>Raspberry Pi 2 B</a>
(for the 4 cores and 1GB of RAM). I&rsquo;d really recommend going with the Pi 2 B, so
you have one core and 256MB RAM for each USB port (potential OSD). In this guide
I will outline the parts, software I used and some options that you can use for
achieving better performance. This guide assumes you have access to a Linux PC
with an SD card reader. It also assumes you have a working knowledge of Linux in
general and a passing familiarity with Ceph.</p><h2 id=parts>Parts</h2><p>Although I will explain many options in this guide, this is the minimum you will
need to get a cluster up and running, this list assumes 3 Pi nodes.</p><ul><li>3 x 3ft Cat6 Cables</li><li>3 x Raspberry Pi 2 B</li><li>3 x Raspberry Pi 2 B Case</li><li>3 x 2 Amp Micro USB Power Supply</li><li>3 empty ports on a gigabit router</li><li>3 x Class 10 MicroSD (16GB or more) for OS drive</li><li>3-12 x USB 2.0 Flash Drives (at least 32GB, better drive for better
performance)</li></ul><p>I used 3 x 64GB flash drives, 3 x 32GB MicroSD and existing ports on my router.
My cost came in at about $250. You can add to this list based on what you add
to your setup throughout the guide, but this is pretty much the minimum for a
fully functional Ceph cluster.</p><h2 id=operating-system>Operating System</h2><p>Raspbian. The testing repository for Raspbian has the many packages of Ceph
0.80.9 and dependencies pre-compiled. Everything you&rsquo;ll need for this tutorial
and is the &ldquo;de facto&rdquo; OS of choice for flexibility on Raspberry Pi. You can
download the Raspbian image
here: <a href=http://downloads.raspberrypi.org/raspbian_latest>Raspbian Download</a>.
Once you have the image, you&rsquo;ll want to put it on an SD card. For this
application I recommend using at least a 16GB MicroSD card (Class 10
preferably - OS drive speed matters for Ceph monitor processes). To transfer the
image on Linux, you can use DD. run the lsblk command to display your devices
once you&rsquo;ve inserted the card into your card reader. Then you can use dd  to
transfer the image to your SD. The command below assumes the image name is
raspbian-wheezy.img  and that it lives in your present working directory. The
above command also assumes that your SD card is located at /dev/mmcblk0 adjust
these accordingly and make sure that your SD card doesn&rsquo;t contain anything
important and is empty.</p><p><code>sudo dd bs=4M if=raspbian-wheezy.img of=/dev/mmcblk0</code></p><p>This command will take a few minutes to complete. Once it does run sync to flush
all cache to disk and make sure it is safe to remove the device. You&rsquo;ll then
boot up into Raspbian, re-size the image to the full size of your MicroSD, set a
memorable password, overclock if you want. Once this is done there are a few
modifications to make. We&rsquo;ll get into this in the installation section below. I
don&rsquo;t recommend using too large of a MicroSD as later in this tutorial we will
image the whole OS from our first MicroSD for deployment to our other Pi nodes.</p><h2 id=hardware-limitations>Hardware Limitations</h2><p>The first limitation to consider is overall storage space. Ceph OSD processes
require roughly 1MB of RAM per GB of storage. Since we are co-locating monitor
processes the effective storage limitation is 512GB per Pi 2 B (4 x 128GB
sticks) RAW (before Ceph replication or erasure coding overhead). Network speed
is also a factor as discussed later in document. You will hit network speed
limitations before you hit the speed limitations of the Pi 2 B&rsquo;s single USB 2.0
bus (480Mbit).</p><h2 id=network>Network</h2><p>In this setup I used empty ports on my router. I run a local DNS server on my
home router and use static assignments for local DNS. You may want to consider
just using a flat 5 or 8 port (depending on number of nodes you plan to have)
gigabit switch for the cluster network and WiPi modules for the public
(connected to your router via WiFi). The nice thing about using a flat layer 2
switch is that if all the Pi nodes are in the same subnet, you don&rsquo;t have to
worry about a gateway and it also keeps the cost down (compared to using router
ports) while reducing the network overhead (for Ceph replication) on your home
network. Using a dedicated switch for the cluster network will also increase
your cluster performance, especially considering the 100Mbit limitations of the
Pi 2 B&rsquo;s network port. By using
a <a href=http://thepihut.com/products/usb-wifi-adapter-for-the-raspberry-pi>BGN Dongle for Pi</a>  and
a dedicated switch for the cluster network, you will get a speedier cluster.
This will use one of your 4 USB ports and thus, you will get one less OSD per
Pi. Keep in mind, depending on if you use replication or erasure coding
private traffic can be 1-X times greater then client IO  (X being 3 in a
standard replication profile) if that matters for your application. Of course
this is all optional and for additional &ldquo;clustery goodness&rdquo;. It really depends
on budget, usage - etcetera.</p><h2 id=object-storage-daemons>Object Storage Daemons</h2><p>In this guide, I co-located OSD journals on the OSD drives. For better
performance, you can use a faster USB like the SanDisk Extreme 3.0 (keep in mind
that you&rsquo;ll be limited by the 60MB/s speed of USB 2.0). Using a dedicated
(faster) journal drive will yield much better performance. But you don&rsquo;t really
need to worry about it unless you are using multiple networks as outlined above.
If you are not, 4 decent USB sticks will saturate your 100Mbit NIC per node.
There is a lot more to learn about Ceph architecture that I cover in this
article and I highly recommend you do so <a href=http://ceph.com/docs/v0.80.5/>here</a>.</p><h3 id=osd-filesystem>OSD Filesystem</h3><p>XFS is the default in Ceph Firefly. I prefer
<a href=https://btrfs.wiki.kernel.org/index.php/Main_Page>BTRFS</a> as an OSD filesystem
for multi-fold reasons and I use it in this tutorial.</p><h2 id=installation>Installation</h2><p>Assuming you have setup your network and operating system - have 3 nodes and the
hardware you want to use - we can begin. The first thing to do is wire up power
and network as you see fit. After that, you&rsquo;ll want to run through the initial
raspi-config on what will become your admin node. Then it&rsquo;s time to make some
changes. Once your admin node is booted and configured, you have to edit
/etc/apt/sources.list . Raspbian Wheezy has archaic versions of Ceph in the main
repository, but the latest firefly version in the testing repository. Before we
delve into this, I find it useful to install some basic tools and requirements.
Connect via SSH or directly to terminal and issue this command from the Pi:</p><p><code>sudo apt-get install vim screen htop iotop btrfs-tools lsb-release gdisk</code></p><p>From this point forward we will assume you are connecting to your Pi nodes via
SSH. You&rsquo;ve just installed BTRFS-tools, vim (better then vi) and some
performance diagnostics tools I like. Now that we have vim  it&rsquo;s time to edit
our sources:</p><p><code>vi /etc/apt/sources.list</code></p><p>You&rsquo;ll see the contents of your sources file. Which will look like this:</p><p><code>deb http://mirrordirector.raspbian.org/raspbian/ wheezy main contrib non-free rpi</code></p><h3 id=uncomment-line-below-then-apt-get-update-to-enable-apt-get-source>Uncomment line below then &lsquo;apt-get update&rsquo; to enable &lsquo;apt-get source&rsquo;</h3><p><code>#deb-src http://archive.raspbian.org/raspbian/ wheezy main contrib non-free rpi</code></p><p>Modify it to look like this:</p><p><code>deb http://mirrordirector.raspbian.org/raspbian/ testing main contrib non-free rpi</code></p><h3 id=uncomment-line-below-then-apt-get-update-to-enable-apt-get-source-1>Uncomment line below then &lsquo;apt-get update&rsquo; to enable &lsquo;apt-get source&rsquo;</h3><p><code>#deb-src http://archive.raspbian.org/raspbian/ testing main contrib non-free rpi</code></p><p>We&rsquo;ve replaced wheezy  with testing .Once this is done, then issue this command:</p><p><code>sudo apt-get update</code></p><p>Once this process has completed is time to start getting the OS ready for Ceph.
Everything we do in this section up to the point of imaging the OS is needed for
nodes that will run Ceph. First we will create a ceph user and give it
password-less sudo access. To do so issue these commands:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>ssh user@ceph-server
sudo useradd -d /home/ceph -m ceph
sudo passwd ceph
</code></pre></div><p>Set the password to a memorable one as it will be used on all of your nodes in
this guide. Now we need to give the ceph user sudo access</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>echo</span> <span class=s2>&#34;ceph ALL = (root) NOPASSWD:ALL&#34;</span> <span class=p>|</span> sudo tee /etc/sudoers.d/ceph
sudo chmod <span class=m>0440</span> /etc/sudoers.d/ceph
</code></pre></div><p>We&rsquo;ll be using ceph-deploy later and it&rsquo;s best to have a defult user to login as
all the time. Issue this command:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>mkdir -p ~/.ssh/
</code></pre></div><p>Then create this file using vi:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>vi ~/.ssh/config
</code></pre></div><p>I assume 3 nodes in this tutorial and a naming convention of piY, where Y is the
node number starting from 1.</p><pre><code>Host pi1
Hostname pi1
User ceph
Host pi2
Hostname pi2
User ceph
Host pi3
Hostname pi3
User ceph
</code></pre><p>Save the file and exit. As far as hostnames, you can use whatever you want of
course. As I mentioned, I run local DNS and DHCP with static assignments. If you
do not, you&rsquo;ll need to edit /etc/hosts  so that your nodes can resolve
each-other. You can do this after the OS image, as each node will have a
different IP. Now it&rsquo;s time to install the ceph-deploy tool. Raspbian wget  can
be strange with HTTPS so we will ignore the certificate (do so at your own
peril):</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>wget --no-check-certificate -q -O- <span class=s1>&#39;https://ceph.com/git/?p=ceph.git;a=blob\_plain;f=keys/release.asc&#39;</span> <span class=p>|</span> sudo apt-key add -
<span class=nb>echo</span> deb http://ceph.com/debian-firefly/ wheezy main <span class=p>|</span> sudo tee /etc/apt/sources.list.d/ceph.list
</code></pre></div><p>Now that we&rsquo;ve added the Ceph repository, we can install ceph-deploy:</p><p><code>sudo apt-get update && sudo apt-get install ceph-deploy ceph ceph-common</code></p><p>Since we are installing ceph from the Raspbian repositories, we need to change
the default behavior of ceph-deploy:</p><p><code>sudo vi /usr/share/pyshared/ceph_deploy/hosts/debian/install.py</code></p><p>Change</p><pre><code>def install(distro, version_kind, version, adjust_repos):
codename = distro.codename
machine = distro.machine_type
</code></pre><p>To</p><pre><code>def install(distro, version_kind, version, adjust_repos):
adjust_repos = False
codename = distro.codename
machine = distro.machine_type
</code></pre><p>This will prevent ceph-deploy from altering repos as the Ceph armhf (Rasberry
Pi&rsquo;s processor type) repos are mostly empty. Finally, we should revert the
contents of /etc/apt/sources.list :</p><p><code>sudo vi /etc/apt/sources.list</code></p><p>You&rsquo;ll see the contents of your sources file. Which will look like this:</p><pre><code>deb http://mirrordirector.raspbian.org/raspbian/ testing main contrib non-free rpi
# Uncomment line below then 'apt-get update' to enable 'apt-get source'
#deb-src http://archive.raspbian.org/raspbian/ testing main contrib non-free rpi
</code></pre><p>Modify it to look like this:</p><pre><code>deb http://mirrordirector.raspbian.org/raspbian/ wheezy main contrib non-free rpi
# Uncomment line below then 'apt-get update' to enable 'apt-get source'
#deb-src http://archive.raspbian.org/raspbian/ wheezy main contrib non-free rpi
</code></pre><p>We&rsquo;ve replaced testing  with wheezy .Once this is done, then issue this command:</p><pre><code>sudo apt-get update
</code></pre><h2 id=kernel-tweaks>Kernel Tweaks</h2><p>We are also going to tweak some kernel parameters for better stability. To do so
we will edit /etc/sysctl.conf .</p><p><code>vi /etc/sysctl.conf</code></p><p>At the bottom of the file, change add the following lines:</p><pre><code>vm.swappiness=1
vm.min_free_kbytes = 32768
kernel.pid_max = 32768
</code></pre><h2 id=imaging-the-os>Imaging the OS</h2><p>Now we have a good baseline for deploying ceph to our other Pi nodes. It&rsquo;s time
to stop our admin node and image the drive (MicroSD). Issue:</p><p><code>sudo halt</code></p><p>Then unplug power to your Pi node and remove the MicroSD. Insert the microSD in
your SD adapter, then the SD adapter into your Linux PC. You&rsquo;ll need at least as
much free drive space on your PC as the size of the MicroSD card.Where
/dev/mmcblk0 is your SD card and pi-ceph.img is your image destination, run:</p><p><code>sudo dd if=/dev/mmcblk0 of=ceph-pi.img bs=4M</code></p><p>This can take a vary long time depending on the size of your SD and you can
compress it with gzip  or xz  for long term storage (empty space compresses
really well it turns out). Once the command returns, run sync  to flush the
cache to disk and make sure you can remove the MicroSD</p><h2 id=imaging-your-nodes-os-drives>Imaging Your Nodes OS Drives</h2><p>Now that you have a good baseline image on your PC, you are ready to crank out
&ldquo;Ceph-Pi&rdquo; nodes - without redoing all of the above. To do so, insert a fresh
MicroSD into your adapter and then PC. Then assuming ceph-pi.img  is your OS
image and /dev/mmcblk0 is your MicroSD card run:</p><p><code>sudo dd if=ceph-pi.img of=/dev/mmcblk0 bs=4M</code></p><p>Repeat this for a many nodes as you intend to deploy.</p><h2 id=createa-ceph-cluster-on-raspberry-pi>Create a Ceph Cluster on Raspberry Pi</h2><p>Insert your ceph-pi MicroSD cards into your Pi nodes and power them all on.
You&rsquo;ve made it this far, now it&rsquo;s time to get &ldquo;cephy&rdquo;. Deploying with
ceph-deploy is a breeze. First we need to SSH to our admin node, make sure you
have setup IPs, network and /etc/hosts on all Pi nodes if you are not using
local DNS and DHCP with static assignments. We need to generate and distribute
an SSH key for password-less authentication between nodes. To do so run (leave
the password blank):</p><pre><code>ssh-keygen
Generating public/private key pair.
Enter file in which to save the key (/ceph-client/.ssh/id\_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /ceph-client/.ssh/id\_rsa.
Your public key has been saved in /ceph-client/.ssh/id\_rsa.pub.

Now copy the key to all nodes (assuming 3 with the naming convention from above):

ssh-copy-id ceph@pi1
ssh-copy-id ceph@pi2
ssh-copy-id ceph@pi3
</code></pre><p>You will be prompted for the password you created for the ceph user each time to
establish initial authentication. Once that is done and you are connected to
your admin node (1st node in the cluster) as the pi user you&rsquo;ll want to create
an admin node directory:</p><pre><code>mkdir -p ~/ceph-pi-cluster
cd ~/ceph-pi-cluster
</code></pre><h3 id=creating-an-initial-ceph-configuration>Creating an initial Ceph Configuration</h3><p>We are going to create an initial Ceph configuration assuming all 3 pi nodes as
monitors. If you have more, keep in mind - you always want an odd number of
monitors to avoid a
<a href=http://en.wikipedia.org/wiki/Split-brain_(computing)>split-brain</a> scenario.
To to this run:</p><p><code>ceph-deploy new pi1 pi2 pi3</code></p><p>Now there are some special tweaks that should be made for best stability and
performance within the hardware limitations of the Raspberry Pi 2 B. To apply
these changes we&rsquo;ll need to edit the ceph.conf here on the admin node before it
is distributed. To do so:</p><p><code>vi ~/ceph-pi-cluster/ceph.conf</code></p><p>After the existing lines add:</p><div class=highlight><pre class=chroma><code class=language-ini data-lang=ini><span class=c1># Disable in-memory logs</span>
<span class=na>debug_lockdep</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_context</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_crush</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_buffer</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_timer</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_filer</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_objecter</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_rados</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_rbd</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_journaler</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_objectcatcher</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_client</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_osd</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_optracker</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_objclass</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_filestore</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_journal</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_ms</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_monc</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_tp</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_auth</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_finisher</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_heartbeatmap</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_perfcounter</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_asok</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_throttle</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_mon</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_paxos</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>debug_rgw</span> <span class=o>=</span> <span class=s>0/0</span>
<span class=na>osd heartbeat grace</span> <span class=o>=</span> <span class=s>8</span>

<span class=k>[mon]</span>
<span class=na>mon compact on start</span> <span class=o>=</span> <span class=s>true</span>
<span class=na>mon osd down out subtree_limit</span> <span class=o>=</span> <span class=s>host</span>

<span class=k>[osd]</span>

<span class=c1># Filesystem Optimizations</span>

<span class=na>osd journal size</span> <span class=o>=</span> <span class=s>1024</span>

<span class=c1># Performance tuning</span>

<span class=na>max open files</span> <span class=o>=</span> <span class=s>327680</span>
<span class=na>osd op threads</span> <span class=o>=</span> <span class=s>2</span>
<span class=na>filestore op threads</span> <span class=o>=</span> <span class=s>2</span>

<span class=c1>#Capacity Tuning</span>
<span class=na>osd backfill full ratio</span> <span class=o>=</span> <span class=s>0.95</span>
<span class=na>mon osd nearfull ratio</span> <span class=o>=</span> <span class=s>0.90</span>
<span class=na>mon osd full ratio</span> <span class=o>=</span> <span class=s>0.95</span>

<span class=c1># Recovery tuning</span>

<span class=na>osd recovery max active</span> <span class=o>=</span> <span class=s>1</span>
<span class=na>osd recovery max single start</span> <span class=o>=</span> <span class=s>1</span>
<span class=na>osd max backfills</span> <span class=o>=</span> <span class=s>1</span>
<span class=na>osd recovery op priority</span> <span class=o>=</span> <span class=s>1</span>

<span class=c1># Optimize Filestore Merge and Split</span>

<span class=na>filestore merge threshold</span> <span class=o>=</span> <span class=s>40</span>
<span class=na>filestore split multiple</span> <span class=o>=</span> <span class=s>8</span>
</code></pre></div><h3 id=creating-initial-monitors>Creating Initial Monitors</h3><p>Now we can deploy our spiffy ceph.conf, create our initial monitor daemons,
deploy our authentication keyring and chmod it as needed. We will be deploying
to all 3 nodes for the purposes of this guide:</p><pre><code>ceph-deploy mon create-initial
ceph-deploy admin pi1 pi2 pi3
for i in pi1 pi2 pi3;do ssh $i chmod 644 /etc/ceph/ceph.client.admin.keyring;done
</code></pre><h3 id=creating-osds-object-storage-daemons>Creating OSDs (Object Storage Daemons)</h3><p>Ready to create some storage? I know I am. Insert your USB keys of choice into
your Pi USB ports. For the purposes of this guide I will be deploying 1 OSD (USB
key) per Pi node. I will also be using the BTRFS filesystem and co-locating the
journals on the OSDs with a default journal size of 1GB (assuming 2 * 40MB/s
throughput max and a default filestor max sync interval of 5). This value is
hard coded into our ceph-pi config above. The formula is:</p><p><code>osd journal size = {2 * (expected throughput * filestore max sync interval)}</code></p><p>So let&rsquo;s deploy our OSDs. Once our USBs are plugged in, use lsblk to display the
device locations. To make sure our drives are clean and have a GPT partition
table, use the gdisk  command for each OSD on each node. Assuming /dev/sda  as
our OSD: gdisk /dev/sda Create a new partition table, write it to disk and exit.
Do this for each OSD on each node. You can craft a bash for  loop if you are
feeling &ldquo;bashy&rdquo; or programmatic. Once all OSD drives have a fresh partition
table you can use ceph-deploy to create your OSDs (using BTRFS for this guide)
where pi1 is our present node and /dev/sda is the OSD we are creating:</p><p><code>ceph-deploy osd create --fs-type btrfs pi1:/dev/sda</code></p><p>Repeat this for all OSD drives on all nodes (or write a for loop). Once you&rsquo;ve
created at least 3 you are ready to move on.</p><h2 id=checking-cluster-health>Checking Cluster Health</h2><p>Congratulations! You should have a working Ceph-Pi cluster. Trust, but verify.
Get the health status of your cluster using this command:</p><p><code>ceph -s</code></p><p>and for a less verbose output</p><p><code>ceph health</code></p><h2 id=what-to-do-now>What to do now?</h2><p>Use your storage cluster! Create an RBD, mount it - export NFS or CIFS. There is
a lot of reading out there. Now you know how to deploy a Ceph cluster on
Raspberry Pi.</p></div><footer><hr><p>Published
by <span itemprop=author>Bryan Apperson</span>
<time itemprop=datePublished datetime=2015-05-13T01:35:35+00:00>13 May, 2015</time>
and tagged <a rel=tag href=/tags/arm/>arm</a>, <a rel=tag href=/tags/ceph/>ceph</a>, <a rel=tag href=/tags/rados/>rados</a>, <a rel=tag href=/tags/raspberry-pi/>raspberry-pi</a> and <a rel=tag href=/tags/storage/>storage</a>
using <span itemprop=wordCount>2980</span> words.</p><div id=comment-submitted class=dialog><h3>Thank you</h3><p>Your comment has been submitted and will be published once it has been approved. You can <a href=https://bryanapperson.com/blog/the-definitive-guide-ceph-cluster-on-raspberry-pi/>go back</a> now. Thank You!</p><p><a href=https://github.com/bryanapperson/blog/pulls>Click here</a> to see the pull request you generated.</p></div><div id=comment-error class=dialog><h3>OOPS!</h3><p>Your comment has not been submitted. Please <a href=https://bryanapperson.com/blog/the-definitive-guide-ceph-cluster-on-raspberry-pi/>go back</a> and try again. Thank You!</p><p>If this error persists, please open an issue by <a href=https://github.com/bryanapperson/blog/issues>clicking here</a>.</p></div><div id=comment-form><h2 id=comment-form-header>Say something</h2><form method=post action=https://dev.staticman.net/v3/entry/github/bryanapperson/blog/master/comments><input type=hidden name=options[redirect] value=https://bryanapperson.com/blog/the-definitive-guide-ceph-cluster-on-raspberry-pi/#comment-submitted>
<input type=hidden name=options[redirectError] value=https://bryanapperson.com/blog/the-definitive-guide-ceph-cluster-on-raspberry-pi/#comment-error>
<input type=hidden name=options[slug] value=the-definitive-guide-ceph-cluster-on-raspberry-pi>
<input type=hidden name=options[section] value=blog>
<input type=hidden name=options[origin] value=https://bryanapperson.com/blog/the-definitive-guide-ceph-cluster-on-raspberry-pi/>
<input type=hidden name=options[parent] value=the-definitive-guide-ceph-cluster-on-raspberry-pi>
<input type=hidden name=fields[reply_to]>
<input type=address name=fields[botpot] placeholder="botpot (do not fill!)" style=display:none><fieldset><input name=fields[name] type=text placeholder="Your name"></fieldset><fieldset><input name=fields[email] type=email placeholder="Your email address"></fieldset><fieldset><textarea name=fields[body] placeholder="You can use Markdown syntax" rows=10></textarea></fieldset><fieldset><input type=submit value=Submit id=submit-button class=right>
<input type=reset value=Reset class=right></fieldset></form></div><h2>Comments (1)</h2><div class=comment-header><figure class="frame comment-avatar"><img src="https://www.gravatar.com/avatar/63463ed1650d3c2a502d279e2445559c?s=70"></figure><p class=comment-info><strong>Fil</strong><br><small>Monday, May 11, 2020</small></p></div><div id=20622aa0-93a6-11ea-8da2-d30c5a1ea0d3 class=comment-thread><blockquote class=comment>Hi, thank you very much for this guide. It&rsquo;s really helpful.
I just wonder what the command <code>ssh user@ceph-server</code> is all about. I didn&rsquo;t find anything concrete in the <a href=https://docs.ceph.com/docs/master/rados/deployment/preflight-checklist/#create-a-user>ceph documentation</a>. Should I connect it here to the admin node to create a ceph-user via ssh?</blockquote><div class=comment-reply-button><input id=20622aa0-93a6-11ea-8da2-d30c5a1ea0d3 type=button class=right value="Reply to Fil" onclick="replyTo('20622aa0-93a6-11ea-8da2-d30c5a1ea0d3','Fil')"></div><div style=clear:both></div></div><script async src=/js/staticman.js></script></footer></article></main><footer><small class=muted>Copyright &copy; Bryan Apperson. Licensed under <a target=_blank rel="external noopener license" href=https://creativecommons.org/licenses/by-nd/4.0/>CC-BY-ND-4.0</a>. Hosted on <a href=https://github.com/bryanapperson/blog rel=external target=_blank>Github</a>.</small></footer></body></html>
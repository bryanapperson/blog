<!doctype html><html lang=en-us><head><meta http-equiv=content-security-policy content="default-src 'self' https: 'unsafe-inline' 'unsafe-eval'; worker-src 'self' blob:; connect-src 'self' wss: data:; font-src 'self' https: data:; img-src 'self' https: data:; object-src 'none'"><meta name=generator content="After Dark Hugo"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Ceph OSD Performance: Backends and Filesystems | Bryan Apperson</title><meta name=description content="Ceph OSD performance on various filesystems and backends including btrfs, for the Atlanta ceph meetup."><meta name=keywords content="atlanta,bluestore,btrfs,ceph,storage,xfs"><meta property="og:title" content="Ceph OSD Performance: Backends and Filesystems"><meta property="og:description" content="Ceph OSD performance on various filesystems and backends including btrfs, for the Atlanta ceph meetup."><meta property="og:type" content="article"><meta property="og:url" content="https://bryanapperson.com/blog/ceph-osd-performance-backends-and-filesystems/"><meta property="og:image" content="https://source.unsplash.com/collection/983219/2000x1322"><meta property="article:section" content="blog"><meta property="article:published_time" content="2016-04-12T04:40:48+00:00"><meta property="article:modified_time" content="2020-02-17T21:24:48+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://source.unsplash.com/collection/983219/2000x1322"><meta name=twitter:title content="Ceph OSD Performance: Backends and Filesystems"><meta name=twitter:description content="Ceph OSD performance on various filesystems and backends including btrfs, for the Atlanta ceph meetup."><meta property="og:image" content="https://source.unsplash.com/collection/983219/2000x1322"><meta name=referrer content="same-origin"><script integrity="sha512-2t0yyNrUdtn9WGIoBVxq5vtoJQYfoDQDbqRPpOb75f1hiL39DGLdJKDrGP60fBhXfrFeKyVhzWJvHvLgln/ElA==">/*! Fetch Inject v2.0.4 | Copyright (C) Josh Habdas <jhabdas@protonmail.com> (https://habd.as) | @license Zlib */var fetchInject=function(){"use strict";const a=function(g,c,d,e,f,a,b){a=c.createElement(d),b=c.getElementsByTagName(d)[0],a.appendChild(c.createTextNode(e.text)),a.onload=f(e),b?b.parentNode.insertBefore(a,b):c.head.appendChild(a)};return function(f,b){if(!arguments.length)return Promise.reject(new ReferenceError("Failed to execute 'fetchInject': 1 argument required but only 0 present."));if(arguments[0]&&arguments[0].constructor!==Array)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 1 must be of type 'Array'."));if(arguments[1]&&arguments[1].constructor!==Promise)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 2 must be of type 'Promise'."));const c=[],d=b?[].concat(b):[],e=[];return f.forEach(a=>d.push(window.fetch(a).then(a=>[a.clone().text(),a.blob()]).then(a=>Promise.all(a).then(a=>{c.push({text:a[0],blob:a[1]})})))),Promise.all(d).then(()=>(c.forEach(b=>{e.push({then:c=>{b.blob.type.includes("text/css")?a(window,document,"style",b,c):a(window,document,"script",b,c)}})}),Promise.all(e)))}}()</script><script integrity="sha512-2XlvnxweZhaHgBdCoOK0PoCUWiSfKibb+RCRZNgqLdvbnx0ZH67FDGKQqmpqCerjMJbZFv6fsXgbmJOOA9K+qA==">/*!
 * Copyright (C) 2019  Josh Habdas <jhabdas@protonmail.com>
 *
 * This file is part of After Dark.
 *
 * After Dark is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published
 * by the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * After Dark is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */fetchInject(["/js/lazysizes.min.js"])</script><meta title=mod:fractal-forest content="status:enabled"><script async src=/js/bpgdec8a.js integrity="sha384-8PG0go3BW8hLm63KbTxk/hNcehaoSbrAhKzsmy2Jhs/KY8QdiKKkjhdeyHY/Q/0I
"></script><link rel=canonical href=https://bryanapperson.com/blog/ceph-osd-performance-backends-and-filesystems/><link rel=icon sizes=any href="data:image/svg+xml,%3Csvg viewBox=%220 0 46 45%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Ctitle%3EAfter Dark%3C/title%3E%3Cpath d=%22M.708 45 23 .416 45.292 45H.708zM35 38 23 19 11 38h24z%22 fill=%22%23000%22/%3E%3C/svg%3E"><style>html{font-size:12px}*{box-sizing:border-box;text-rendering:geometricPrecision}body{font-size:1rem;line-height:1.5rem;margin:0;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;word-wrap:break-word}h1,h2,h3,h4,h5,h6{line-height:1.3em}fieldset{border:none;padding:0;margin:0}pre{padding:2rem;margin:1.75rem 0;background-color:#fff;border:1px solid #ccc;overflow:auto}code[class*=language-],pre[class*=language-],pre code{font-weight:100;text-shadow:none;margin:1.75rem 0}a{cursor:pointer;color:#ff2e88;text-decoration:none;border-bottom:1px solid #ff2e88}a:hover{background-color:#ff2e88;color:#fff}.grid{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.grid.\-top{-ms-flex-align:start;align-items:flex-start}.grid.\-middle{-ms-flex-align:center;align-items:center}.grid.\-bottom{-ms-flex-align:end;align-items:flex-end}.grid.\-stretch{-ms-flex-align:stretch;align-items:stretch}.grid.\-baseline{-ms-flex-align:baseline;align-items:baseline}.grid.\-left{-ms-flex-pack:start;justify-content:flex-start}.grid.\-center{-ms-flex-pack:center;justify-content:center}.grid.\-right{-ms-flex-pack:end;justify-content:flex-end}.grid.\-between{-ms-flex-pack:justify;justify-content:space-between}.grid.\-around{-ms-flex-pack:distribute;justify-content:space-around}.cell{-ms-flex:1;flex:1;box-sizing:border-box}@media screen and (min-width:768px){.cell.\-1of12{-ms-flex:0 0 8.33333%;flex:0 0 8.33333%}.cell.\-2of12{-ms-flex:0 0 16.66667%;flex:0 0 16.66667%}.cell.\-3of12{-ms-flex:0 0 25%;flex:0 0 25%}.cell.\-4of12{-ms-flex:0 0 33.33333%;flex:0 0 33.33333%}.cell.\-5of12{-ms-flex:0 0 41.66667%;flex:0 0 41.66667%}.cell.\-6of12{-ms-flex:0 0 50%;flex:0 0 50%}.cell.\-7of12{-ms-flex:0 0 58.33333%;flex:0 0 58.33333%}.cell.\-8of12{-ms-flex:0 0 66.66667%;flex:0 0 66.66667%}.cell.\-9of12{-ms-flex:0 0 75%;flex:0 0 75%}.cell.\-10of12{-ms-flex:0 0 83.33333%;flex:0 0 83.33333%}.cell.\-11of12{-ms-flex:0 0 91.66667%;flex:0 0 91.66667%}}@media screen and (max-width:768px){.grid{-ms-flex-direction:column;flex-direction:column}.cell{-ms-flex:0 0 auto;flex:none}}.hack,.hack blockquote,.hack code,.hack em,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack strong{font-size:1rem;font-style:normal;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif}.hack blockquote,.hack code,.hack em,.hack strong{line-height:20px}.hack blockquote,.hack code,.hack footer,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack header,.hack li,.hack ol,.hack p,.hack section,.hack ul{float:none;margin:0;padding:0}.hack blockquote,.hack h1,.hack ol,.hack p,.hack ul{margin-top:20px;margin-bottom:20px}.hack h1{position:relative;display:inline-block;display:table-cell;padding:20px 0 30px;margin:0;overflow:hidden}.hack h1:after{content:"====================================================================================================";position:absolute;bottom:10px;left:0}.hack h1+*{margin-top:0}.hack h2,.hack h3,.hack h4,.hack h5,.hack h6{position:relative;margin-bottom:1.75rem}.hack h2:before,.hack h3:before,.hack h4:before,.hack h5:before,.hack h6:before{display:inline}.hack h2:before{content:"## "}.hack h3:before{content:"### "}.hack h4:before{content:"#### "}.hack h5:before{content:"##### "}.hack h6:before{content:"###### "}.hack li{position:relative;display:block;padding-left:20px}.hack li:after{position:absolute;top:0;left:0}.hack ul>li:after{content:"-"}.hack ol{counter-reset:a}.hack ol>li:after{content:counter(a)".";counter-increment:a}.hack ol li:nth-child(n+10):after{left:-7px}.hack blockquote{position:relative;padding-left:17px;padding-left:2ch;overflow:hidden}.hack blockquote:after{content:">\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>";white-space:pre;position:absolute;top:0;left:0;line-height:20px}.hack em:after,.hack em:before{content:"*";display:inline}.hack pre code:after,.hack pre code:before{content:""}.hack code{font-weight:700}.hack code:after,.hack code:before{content:"`";display:inline}.hack hr{position:relative;height:20px;overflow:hidden;border:0;margin:20px 0}.hack hr:after{content:"----------------------------------------------------------------------------------------------------";position:absolute;top:0;left:0;line-height:20px;width:100%;word-wrap:break-word}@-moz-document url-prefix(){.hack h1{display:block}}.hack-ones ol>li:after{content:"1."}p{margin:0 0 1.75rem}.container{max-width:70rem}.container,.container-fluid{margin:0 auto;padding:0 1rem}.inner{padding:1rem}.inner2x{padding:2rem}.pull-left{float:left}.pull-right{float:right}.progress-bar{height:8px;opacity:.8;background-color:#ccc;margin-top:12px}.progress-bar.progress-bar-show-percent{margin-top:38px}.progress-bar-filled{background-color:gray;height:100%;transition:width .3s ease;position:relative;width:0}.progress-bar-filled:before{content:"";border:6px solid transparent;border-top-color:gray;position:absolute;top:-12px;right:-6px}.progress-bar-filled:after{color:gray;content:attr(data-filled);display:block;font-size:12px;white-space:nowrap;position:absolute;border:6px solid transparent;top:-38px;right:0;-ms-transform:translateX(50%);transform:translateX(50%)}table{width:100%;border-collapse:collapse;margin:1.75rem 0;color:#778087}table td,table th{vertical-align:top;border:1px solid #ccc;line-height:15px;padding:10px}table thead th{font-size:10px}table tbody td:first-child{font-weight:700;color:#333}.form{width:30rem}.form-group{margin-bottom:1.75rem;overflow:auto}.form-group label{border-bottom:2px solid #ccc;color:#333;width:10rem;display:inline-block;height:38px;line-height:38px;padding:0;float:left;position:relative}.form-group.form-success label{color:#4caf50!important;border-color:#4caf50!important}.form-group.form-warning label{color:#ff9800!important;border-color:#ff9800!important}.form-group.form-error label{color:#f44336!important;border-color:#f44336!important}.form-control{outline:none;border:none;border-bottom:2px solid #ccc;padding:.5rem 0;width:20rem;height:38px;background-color:initial}.form-control:focus{border-color:#555}.form-group.form-textarea label:after{position:absolute;content:"";width:2px;background-color:#fff;right:-2px;top:0;bottom:0}textarea.form-control{height:auto;resize:none;padding:1rem 0;border-bottom:2px solid #ccc;border-left:2px solid #ccc;padding:.5rem}select.form-control{border-radius:0;background-color:initial;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none}.help-block{color:#999;margin-top:.5rem}.form-actions{margin-bottom:1.75rem}.btn{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;cursor:pointer;outline:none;padding:.65rem 2rem;font-size:1rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;z-index:1}.btn:active{box-shadow:inset 0 1px 3px rgba(0,0,0,.12)}.btn.btn-ghost{border-color:#757575;color:#757575;background-color:initial}.btn.btn-ghost:focus,.btn.btn-ghost:hover{border-color:#424242;color:#424242;z-index:2}.btn.btn-ghost:hover{background-color:initial}.btn-block{width:100%;display:-ms-flexbox;display:flex}.btn-default{color:#fff;background-color:#e0e0e0;border:1px solid #e0e0e0;color:#333}.btn-default:focus:not(.btn-ghost),.btn-default:hover{background-color:#dcdcdc;border-color:#dcdcdc}.btn-success{color:#fff;background-color:#4caf50;border:1px solid #4caf50}.btn-success:focus:not(.btn-ghost),.btn-success:hover{background-color:#43a047;border-color:#43a047}.btn-success.btn-ghost{border-color:#4caf50;color:#4caf50}.btn-success.btn-ghost:focus,.btn-success.btn-ghost:hover{border-color:#388e3c;color:#388e3c;z-index:2}.btn-error{color:#fff;background-color:#f44336;border:1px solid #f44336}.btn-error:focus:not(.btn-ghost),.btn-error:hover{background-color:#e53935;border-color:#e53935}.btn-error.btn-ghost{border-color:#f44336;color:#f44336}.btn-error.btn-ghost:focus,.btn-error.btn-ghost:hover{border-color:#d32f2f;color:#d32f2f;z-index:2}.btn-warning{color:#fff;background-color:#ff9800;border:1px solid #ff9800}.btn-warning:focus:not(.btn-ghost),.btn-warning:hover{background-color:#fb8c00;border-color:#fb8c00}.btn-warning.btn-ghost{border-color:#ff9800;color:#ff9800}.btn-warning.btn-ghost:focus,.btn-warning.btn-ghost:hover{border-color:#f57c00;color:#f57c00;z-index:2}.btn-info{color:#fff;background-color:#00bcd4;border:1px solid #00bcd4}.btn-info:focus:not(.btn-ghost),.btn-info:hover{background-color:#00acc1;border-color:#00acc1}.btn-info.btn-ghost{border-color:#00bcd4;color:#00bcd4}.btn-info.btn-ghost:focus,.btn-info.btn-ghost:hover{border-color:#0097a7;color:#0097a7;z-index:2}.btn-primary{color:#fff;background-color:#2196f3;border:1px solid #2196f3}.btn-primary:focus:not(.btn-ghost),.btn-primary:hover{background-color:#1e88e5;border-color:#1e88e5}.btn-primary.btn-ghost{border-color:#2196f3;color:#2196f3}.btn-primary.btn-ghost:focus,.btn-primary.btn-ghost:hover{border-color:#1976d2;color:#1976d2;z-index:2}.btn-group{overflow:auto}.btn-group .btn{float:left}.btn-group .btn-ghost:not(:first-child){margin-left:-1px}.card{border:1px solid #ccc}.card .card-header{color:#333;text-align:center;background-color:#ddd;padding:.5rem 0}.alert{color:#ccc;padding:1rem;border:1px solid #ccc;margin-bottom:1.75rem}.alert-success{color:#4caf50;border-color:#4caf50}.alert-error{color:#f44336;border-color:#f44336}.alert-info{color:#00bcd4;border-color:#00bcd4}.alert-warning{color:#ff9800;border-color:#ff9800}.media:not(:last-child){margin-bottom:1.25rem}.media-left{padding-right:1rem}.media-left,.media-right{display:table-cell;vertical-align:top}.media-right{padding-left:1rem}.media-body{display:table-cell;vertical-align:top}.media-heading{font-size:1.16667rem;font-weight:700}.media-content{margin-top:.3rem}.avatarholder,.placeholder{background-color:#f0f0f0;text-align:center;color:#b9b9b9;font-size:1rem;border:1px solid #f0f0f0}.avatarholder{width:48px;height:48px;line-height:46px;font-size:2rem;background-size:cover;background-position:50%;background-repeat:no-repeat}.avatarholder.rounded{border-radius:33px}.loading{display:inline-block;content:"&nbsp;";height:20px;width:20px;margin:0 .5rem;animation:a .6s infinite linear;border:2px solid #e91e63;border-right-color:transparent;border-radius:50%}.btn .loading{margin-bottom:0;width:14px;height:14px}.btn div.loading{float:left}.alert .loading{margin-bottom:-5px}@keyframes a{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.menu{width:100%}.menu .menu-item{display:block;color:#616161;border-color:#616161}.menu .menu-item.active,.menu .menu-item:hover{color:#000;border-color:#000;background-color:initial}@media screen and (max-width:768px){.form-group label{display:block;border-bottom:none;width:100%}.form-group.form-textarea label:after{display:none}.form-control{width:100%}textarea.form-control{border-left:none;padding:.5rem 0}pre::-webkit-scrollbar{height:3px}}@media screen and (max-width:480px){.form{width:100%}}.dark{color:#ccc}.dark,.dark pre{background-color:#000}.dark pre{padding:0;border:none}.dark pre code{color:#00bcd4}.dark h1 a,.dark h2 a,.dark h3 a,.dark h4 a,.dark h5 a{color:#ccc}.dark code,.dark strong{color:#fff}.dark code{font-weight:100}.dark table{color:#ccc}.dark table td,.dark table th{border-color:#444}.dark table tbody td:first-child{color:#fff}.dark .form-group label{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-group.form-textarea label:after{background-color:#000}.dark .form-control{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-control:focus{border-color:#ccc;color:#ccc}.dark textarea.form-control{color:#ccc}.dark .card{border-color:rgba(95,95,95,.78)}.dark .card .card-header{background-color:initial;color:#ccc;border-bottom:1px solid rgba(95,95,95,.78)}.dark .btn.btn-ghost.btn-default{border-color:#ababab;color:#ababab}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#9c9c9c;color:#9c9c9c;z-index:1}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#e0e0e0;color:#e0e0e0}.dark .btn.btn-ghost.btn-primary:focus,.dark .btn.btn-ghost.btn-primary:hover{border-color:#64b5f6;color:#64b5f6}.dark .btn.btn-ghost.btn-success:focus,.dark .btn.btn-ghost.btn-success:hover{border-color:#81c784;color:#81c784}.dark .btn.btn-ghost.btn-info:focus,.dark .btn.btn-ghost.btn-info:hover{border-color:#4dd0e1;color:#4dd0e1}.dark .btn.btn-ghost.btn-error:focus,.dark .btn.btn-ghost.btn-error:hover{border-color:#e57373;color:#e57373}.dark .btn.btn-ghost.btn-warning:focus,.dark .btn.btn-ghost.btn-warning:hover{border-color:#ffb74d;color:#ffb74d}.dark .avatarholder,.dark .placeholder{background-color:initial;border-color:#333}.dark .menu .menu-item{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .menu .menu-item.active,.dark .menu .menu-item:hover{color:#fff;border-color:#ccc}/*!* Copyright (C) 2019 Josh Habdas <jhabdas@protonmail.com>
*
* This file is part of After Dark.
*
* After Dark is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as published
* by the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* After Dark is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU Affero General Public License for more details.
*
* You should have received a copy of the GNU Affero General Public License
* along with this program. If not, see <https://www.gnu.org/licenses/>.*/:root{scroll-behavior:smooth;--screen-size-small:30em}@keyframes intro{0%{opacity:0}100%{opacity:1}}.blur-up.lazyloading{filter:blur(5px);opacity:1;transition:opacity 1s,filter 1.5s}.blur-up.lazyload{opacity:0;filter:blur(10px)}.blur-up.lazyloaded{filter:blur(0);transition:filter 1s}.hack .readmore{margin-bottom:2.2em}.responsive-iframe,.ratio-container{position:relative;padding-bottom:56.25%;padding-top:25px;height:0}.responsive-iframe iframe,.ratio-container>*:not([itemprop=caption]){position:absolute;top:0;left:0;width:100%;height:100%}iframe{border:0}main,footer{animation:intro .3s both;animation-delay:.15s}header:first-of-type+details{margin:20px 0}footer time[datetime$=M]:before{content:"\2013\0020"}body>footer p.muted{margin-bottom:0}@media only screen and (max-width:768px){footer time[datetime$=M]{display:none}}blockquote cite{display:block}blockquote cite::before{content:"\2014\00A0"}:target{filter:brightness(1.2)}:disabled{cursor:not-allowed}.hack li ul{margin:0}.hack ol li{padding-left:27px}.main{padding:20px 10px}input.form-control{border-radius:0;background-color:initial;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none}input.form-control,textarea.form-control,select.form-control,.help-block{font-size:initial}@media only screen and (max-width:768px){.help-block{font-size:unset}}html{font-size:13px}.hack .form input,.hack .form textarea,.hack .form button,.hack .form label{font-size:1rem}.hack .alert .highlight:first-of-type .chroma,.hack .card .highlight:first-of-type .chroma,.hack .alert pre:first-of-type,.hack .alert p:first-of-type,.hack .card pre:first-of-type,.hack .card p:first-of-type{margin-top:unset}.hack .alert .highlight:last-of-type .chroma,.hack .card .highlight:last-of-type .chroma,.hack .alert pre:last-of-type,.hack .alert p:last-of-type,.hack .card pre:last-of-type,.hack .card p:last-of-type{margin-bottom:unset}.hack blockquote,.hack blockquote:after{line-height:1.5}.hack figure,.standard figure{margin:unset}.hack figure a{border-bottom:none}.hack figure a:hover{background-color:inherit}article header img{width:100%;border-radius:3px}table td,table th{line-height:inherit}table a{border-bottom:unset}img{max-width:100%}@media only screen and (min-width:768px){html{font-size:16px}.container{max-width:50rem}}@media only screen and (min-width:768px),(-ms-high-contrast:active),(-ms-high-contrast:none){html{margin-left:calc(100vw - 100%)}}/*!* Copyright (C) 2019 Josh Habdas <jhabdas@protonmail.com>
*
* This file is part of After Dark.
*
* After Dark is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as published
* by the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* After Dark is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU Affero General Public License for more details.
*
* You should have received a copy of the GNU Affero General Public License
* along with this program. If not, see <https://www.gnu.org/licenses/>.*/a[rel*=external]::after{content:" " url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 class=%22i-external%22 viewBox=%220 0 32 32%22 width=%2214%22 height=%2214%22 fill=%22none%22 stroke=%22%23ff9800%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22 stroke-width=%229.38%25%22%3E%3Cpath d=%22M14 9H3V29H23V18M18 4H28V14M28 4 14 18%22/%3E%3C/svg%3E")}nav a.active{background-color:inherit;color:#fff}a[itemprop=url]{color:#ff9800}a[itemprop=url]:hover{color:#fff}.muted,.help-block{opacity:.7}.hack .muted,.hack .help-block{color:#e0e0e0}.highlighttable td,th{padding:0;border:0}td.code{width:95%}.form-group{position:relative;padding-top:1.5rem}fieldset{border:0}input{width:100%;padding:12px 20px;margin:8px 0;border:2px solid #ccc;border-radius:4px;background-color:#f8f8f8;box-sizing:border-box}textarea{width:100%;height:150px;padding:12px 20px;box-sizing:border-box;border:2px solid #ccc;border-radius:4px;background-color:#f8f8f8;resize:none}input[type=button],input[type=submit],input[type=reset]{background-color:#212121;border:none;color:#fafafa;padding:16px 32px;text-decoration:none;margin:4px 2px;cursor:pointer}.post-comments{margin-top:60px}.post-comment{padding:20px;margin-top:20px}.post-comment-header{margin-bottom:20px}.post-comment-avatar{display:inline-block;vertical-align:middle;border-radius:50%}.post-comment-info{display:inline-block;margin-left:20px;margin-bottom:0;vertical-align:middle}.post-comment-field{display:block;font:inherit;padding:10px;margin-top:20px;width:100%}.dialog{display:none;position:fixed;padding:25px;background-color:#fafafa;padding-top:20%;top:0;left:0;width:100%;height:100%;text-align:center}.dialog:target{display:block}</style><meta name=theme-color content="#000"><script integrity="sha512-ISTAV0GadOIz/NXXHOS+eCM0ysXVVHhQTlvA6LJxz/DeA5yIxm0Vqf5IE+WH0yuuXkayAKtoZkQ326nch5f/fg==">fetchInject(["/css/syntax.css"])</script><noscript><link href=/css/syntax.css rel=stylesheet></noscript></head><body class="hack dark main container"><header><nav itemscope itemtype=https://schema.org/SiteNavigationElement><meta itemprop=name content="Main Menu"><a itemprop=url href=/>Home</a>
<a itemprop=url class=active href=/blog/>Blogs</a>
<a itemprop=url href=/musings/>Musings</a>
<a itemprop=url rel=search href=/search/>Search</a></nav></header><main><style>{{ -}}.hack header figure[itemtype*=ImageObject]{position:relative}.hack header figure[itemtype*=ImageObject] figcaption{position:absolute;bottom:0;right:0;text-align:right;padding:15px;font-style:oblique;font-size:smaller;mix-blend-mode:soft-light}.hack header figure[itemtype*=ImageObject] [itemprop=headline]{font-weight:700}</style><article itemscope itemtype=https://schema.org/BlogPosting><meta itemprop=name content="Ceph OSD Performance: Backends and Filesystems"><meta itemprop=description content="Ceph OSD performance on various filesystems and backends including btrfs, for the Atlanta ceph meetup."><meta itemprop=datePublished content="2016-04-12T04:40:48+00:00"><meta itemprop=dateModified content="2020-02-17T21:24:48+00:00"><meta itemprop=wordCount content="1351"><meta itemprop=image content="https://source.unsplash.com/collection/983219/2000x1322"><meta itemprop=keywords content="atlanta,bluestore,btrfs,ceph,storage,xfs,"><header><h1 itemprop="headline name">Ceph OSD Performance: Backends and Filesystems</h1><p class=muted><svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%"><circle cx="16" cy="16" r="14"/><path d="M16 8v8l4 4"/></svg><span>7 minute read</span><svg style="margin-bottom:-3px" class="i-edit" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%"><path d="M30 7 25 2 5 22 3 29l7-2zM21 6l5 5zM5 22l5 5z"/></svg>
Modified: <time datetime=2020-02-17T21:24:48+00:00>17 Feb, 2020</time></p><blockquote itemprop=description>Ceph OSD performance on various filesystems and backends including btrfs, for the Atlanta ceph meetup.</blockquote></header><div itemprop=articleBody><p>Ceph OSD performance characteristics are one of the most important
considerations when deploying a RADOS (Replicated Asynchronous Distributed
Object Storage) cluster. Ceph is
an open source project for scale out storage based on the
<a target=_blank rel="external noopener" href=https://ceph.com/wp-content/uploads/2016/08/weil-thesis.pdf>CRUSH</a> algorithm. An OSD is an
&ldquo;Object Storage Daemon&rdquo;, which represents a journaling partition and a data
storage partition in the Filestore backend implementation. An OSD is, in a
broader sense where Ceph stores objects which hash to a specific placement group
(PG). A placement group is a hash bucket in a general computer science sense.
 This article explores the performance characteristics and features of various
Ceph OSD backends and filesystems. The content of this article was prepared for
and presented at the April 12th, 2016 Ceph ATL meetup.</p><h2 id=ceph-osd-performance>Ceph OSD Performance</h2><p>Optimal Ceph OSD performance can reduce the capital expense and operational
expense of meeting deployment requirements for a Ceph storage cluster. There are
many considerations and best practices when deploying a Ceph/RADOS cluster which
can enhance performance and stability. Many of those, such as kernel
optimizations, network stack optimizations, choice of hardware and Ceph tuning
parameters are outside the scope of this article. For those interested in other
performance enhancement vectors for Ceph deployments, some were covered at the
Ceph ATL Kick-Off Meetup,
and many can be found in the
<a href=https://www.redhat.com/en/files/resources/en-rhst-cephstorage-supermicro-INC0270868_v2_0715.pdf>Red Hat/Supermicro Ceph reference architecture document</a>. However,
perhaps obviously, the interface to backing storage block devices is integral in
determining the performance of a RADOS cluster. The most widely used deployment
is with the OSD filestore backend and the XFS filesystem. There are interesting
developments in Ceph Jewel, namely the bluestore backend which may change that.</p><h2 id=ceph-osd-backends>Ceph OSD Backends</h2><p>As of the Ceph Jewel release there will be multiple backends which can be used
for Ceph OSDs. This article covers filestore, bluestore and memstore.</p><h3 id=filestore>Filestore</h3><p>At present filestore is the de-facto backend for production Ceph clusters. With
the filestore backend, Ceph writes objects as files on top of a POSIX filesystem
such as XFS, BTRFS or EXT4. With the filestore backend a OSD is composed of an
un-formatted journal partition and an OSD data partition.</p><p>One of the largest drawbacks with the OSD filestore backend is the fact that all
data is written twice, through the journal and then to the backing data
partition. This essentially cuts the write performance of an OSD with co-located
journal and data in twain. This has resulted in many deployments using dedicated
solid state block devices split up into multiple partitions for journals. Many
deployments use a 4:1 or 5:1 ratio for journals to SSD an disk. This requires
the use of additional drive bays and increases the cost to performance ratio
significantly.</p><p>Filestore is the only backend bench-marked in this article.</p><h4 id=filesystems>Filesystems</h4><p>The Ceph filestore OSD backend supports XFS, BTRFS and EXT4 filesystems. The
documentation presently recommends XFS for use in production, and BTRFS for
testing and development environments. Below is a comparison of Ceph OSD
performance for these three filesystems. But before going into Ceph OSD
performance, a feature comparison is useful.</p><h5 id=xfs>XFS</h5><p><a href=https://en.wikipedia.org/wiki/XFS>XFS</a> is used at present in many production
Ceph deployments. XFS was developed for Silicon Graphics, and is a mature and
stable filesystem. The filestore/XFS combination is well tested, stable and
great for use today. There are some tuning parameters which can be used during
filesystem creation and mounting as an OSD data partition which can be used to
improve Ceph OSD performance. These parameters are included in the Ceph
configuration on the
<a href=https://github.com/bryanapperson/ceph-osd-backends>github page</a> for these
tests.</p><h5 id=btrfs>BTRFS</h5><p><a href=https://btrfs.wiki.kernel.org/index.php/Main_Page>BTRFS</a> is a
<a href=http://en.wikipedia.org/wiki/Copy-on-write>copy-on-write</a> filesystem. It
supports file creation timestamps and checksums that verify metadata integrity,
so it can detect bad copies of data and fix them with good copies. BTRFS very
interestingly supports transparent LZO and GZIP compression among and other
features. While the performance of compression on BTRFS will not be covered in
this article, the use in a large scale storage cluster is obvious. The BTRFS
community also aims to provide fsck,
<a href=https://btrfs.wiki.kernel.org/index.php/Deduplication>deduplication</a>, and data
encryption support. BTRFS is not recommended at this time for production use
with Ceph, however according to BTRFS developers, it is no  longer experimental.</p><h5 id=ext4>EXT4</h5><p><a href=https://ext4.wiki.kernel.org/index.php/Main_Page>EXT4</a> is a solid, battle
tested filesystem. However, with a maximum size of 16TB, it is not exactly
future proof (considering that Samsung
<a href=https://news.samsung.com/global/samsung-now-introducing-worlds-largest-capacity-15-36tb-ssd-for-enterprise-storage-systems>has already released a 16TB drive</a>).
It is production ready for use as a Ceph filestore filesystem.</p><h3 id=bluestore>Bluestore</h3><p>Bluestore is set to release for experimental use in Jewel. The benefits of Bluestore are a direct to block OSD,
without filesystem overhead or the need for a &ldquo;double-write&rdquo; penalty (associated
with the filestore journal). Bluestore utilizes RocksDB, which stores object
metadata, a write ahead log, Ceph omap data and allocator metadata. Bluestore
can have 2-3 partitions per, one for RocksDB, one for RocksDB WAL and one for
OSD data (un-formatted - direct to block). Due to time constraints on the
presentation, and the lack of a Ceph Jewel build for Fedora 23. I may follow
this up with a comparison of the best performing filestore backend on RHEL7 and
Ceph bluestore. RocksDB and RocksDB WAL can be placed on the same partition. For
the tests below both RocksDB and OSD data were colocated on the same physical
disk for an apples-to-apples comparison with a co-located filestore backend. A
great in depth explanation of the OSD bluestore backend is available
<a href=http://www.sebastien-han.fr/blog/2016/03/21/ceph-a-new-store-is-coming/>here</a>.</p><h3 id=memstore>MEMSTORE</h3><p>Memstore is an available backend for Ceph. However, it should never be used in
production due to the obvious volatility of memory. Steps for enabling memstore
can be found
<a href=http://www.sebastien-han.fr/blog/2014/04/03/ceph-memstore-backend/>here</a>. Due
to the fact that memstore is not a serious backend for production use, no
performance tests were run with it.</p><h2 id=ceph-osd-performance-test-method>Ceph OSD PERFORMANCE TEST METHOD</h2><p>This section covers how the performance tests in this article were executed, the
environment and overall method. Since this article is strictly about OSD
backends and filesystems, all tests were executed on a single machine to
eliminate network related variance. Journal partitions (for the filestore
backend) were co-located on the same physical disks as the data partitions.</p><h3 id=environment>ENVIRONMENT</h3><p>All performance tests in this article were performed using Ceph Hammer. The
specifications for the test machine are as follows:</p><ul><li>CPU: Intel(R) Core(TM) i7-6700K CPU @ 4.00GHz</li><li>RAM: 32GB DDR4 2133 MHz</li><li>OSDs: 5 x  Seagate ST2000DM001 2TB</li><li>OS: Fedora 23</li><li>OS Drive: 2 x Samsung 850 Pro SSD (BTRFS RAID1)</li></ul><p>The OSD Performance Test Rig[/caption] The test environment was my
personal desktop system. The OSD hard drives are consumer grade Seagate drives.
Block device/drive type has a huge impact on the performance of a Ceph storage
cluster, these 7200 RPM SATA III drives were used for all tests in this article.
To more on how to test the raw performance characteristics of a physical drive
for use as a OSD journal, data or co-located journal/data device see this
<a href=https://github.com/bryanapperson/ceph-disk-test>github repo</a>. This test
cluster was a single monitor, single node &ldquo;cluster&rdquo;. The SATA controller was
on-board ASM1062 and nothing fancy like an LSI-2308. There was a PCIe &ldquo;cache
tier&rdquo; present with 2 M2 form factor SSDs as OSDs, although those were unused in
these tests. The test machine was running kernel 4.3.3-300.</p><h3 id=configurations>CONFIGURATIONS</h3><p>The Ceph configurations filesystem tested are available on
<a href=https://github.com/bryanapperson/ceph-osd-backends>this github repository</a>.
All tests were performed with 3 replica storage pools.</p><h3 id=tools>Tools</h3><p>The build-in rados bench command was used for all performance metrics in this
article.</p><h3 id=ceph-osd-performance-test-results>Ceph OSD Performance Test Results</h3><p>Note: Take the random read speeds with a grain of salt. Even with running echo
3 > /proc/sys/vm/drop_caches in between benchmarks, randomly read objects may
have already been stored in memory.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>*   XFS:
    *   <span class=m>4</span> MB
        *   Write:
            *   IOPS: 19.17
            *   BW: 76.516 MB/s
            *   Latency: 0.835348s
        *   Read:
            *   IOPS: 118.38
            *   BW: 473.466MB/s
            *   Latency: 0.134731s

*   <span class=m>4</span> KB
    *   Write:
        *   IOPS: 203.124
        *   BW: 0.790MB/s
        *   Latency: 0.0789896s
    *   Read:
        *   IOPS: 209.33
        *   BW: 0.812MB/s
        *   Latency: 0.076963s
</code></pre></div><h3 id=conclusion>Conclusion</h3><p>The Filestore/XFS deployment scenario may be the stable way to go for production
Ceph clusters at the present. BTRFS/Filestore may be the most feature rich.
However, with the development of Bluestore this may change in the future.</p></div><footer><hr><p>Published
by <span itemprop=author>Bryan Apperson</span>
<time itemprop=datePublished datetime=2016-04-12T04:40:48+00:00>12 Apr, 2016</time>
and tagged <a rel=tag href=/tags/atlanta/>atlanta</a>, <a rel=tag href=/tags/bluestore/>bluestore</a>, <a rel=tag href=/tags/btrfs/>btrfs</a>, <a rel=tag href=/tags/ceph/>ceph</a>, <a rel=tag href=/tags/storage/>storage</a> and <a rel=tag href=/tags/xfs/>xfs</a>
using <span itemprop=wordCount>1351</span> words.</p><aside><header>Related Content</header><ul><li><a href=/blog/ceph-raw-disk-performance-testing/>Ceph Raw Disk Performance Testing</a>
<time class=muted datetime=2M>2 minutes</time><li><a href=/blog/the-definitive-guide-ceph-cluster-on-raspberry-pi/>The Definitive Guide: Ceph Cluster on Raspberry Pi</a>
<time class=muted datetime=14M>14 minutes</time><li><a href=/blog/mounting-rbd-at-boot-under-centos-7/>Mounting RBD at Boot Under CentOS 7</a>
<time class=muted datetime=2M>2 minutes</time><li><a href=/blog/copy-ceph-pool-objects-to-another-pool/>Copy Ceph Pool Objects to Another Pool</a>
<time class=muted datetime=2M>2 minutes</time></ul></aside><div id=comment-submitted class=dialog><h3>Thank you</h3><p>Your comment has been submitted and will be published once it has been approved. You can <a href=https://bryanapperson.com/blog/ceph-osd-performance-backends-and-filesystems/>go back</a> now. Thank You!</p><p><a href=https://github.com/bryanapperson/blog/pulls>Click here</a> to see the pull request you generated.</p></div><div id=comment-error class=dialog><h3>OOPS!</h3><p>Your comment has not been submitted. Please <a href=https://bryanapperson.com/blog/ceph-osd-performance-backends-and-filesystems/>go back</a> and try again. Thank You!</p><p>If this error persists, please open an issue by <a href=https://github.com/bryanapperson/blog/issues>clicking here</a>.</p></div><div id=comment-form><h2 id=comment-form-header>Say something</h2><form method=post action=https://dev.staticman.net/v3/entry/github/bryanapperson/blog/master/comments><input type=hidden name=options[redirect] value=https://bryanapperson.com/blog/ceph-osd-performance-backends-and-filesystems/#comment-submitted>
<input type=hidden name=options[redirectError] value=https://bryanapperson.com/blog/ceph-osd-performance-backends-and-filesystems/#comment-error>
<input type=hidden name=options[slug] value=ceph-osd-performance-backends-and-filesystems>
<input type=hidden name=options[section] value=blog>
<input type=hidden name=options[origin] value=https://bryanapperson.com/blog/ceph-osd-performance-backends-and-filesystems/>
<input type=hidden name=options[parent] value=ceph-osd-performance-backends-and-filesystems>
<input type=hidden name=fields[reply_to]>
<input type=address name=fields[botpot] placeholder="botpot (do not fill!)" style=display:none><fieldset><input name=fields[name] type=text placeholder="Your name"></fieldset><fieldset><input name=fields[email] type=email placeholder="Your email address"></fieldset><fieldset><textarea name=fields[body] placeholder="You can use Markdown syntax" rows=10></textarea></fieldset><fieldset><input type=submit value=Submit id=submit-button class=right>
<input type=reset value=Reset class=right></fieldset></form></div><script async src=/js/staticman.js></script></footer></article></main><footer><small class=muted>Copyright &copy; Bryan Apperson. Licensed under <a target=_blank rel="external noopener license" href=https://creativecommons.org/licenses/by-nd/4.0/>CC-BY-ND-4.0</a>. Hosted on <a href=https://github.com/bryanapperson/blog rel=external target=_blank>Github</a>.</small></footer></body></html>